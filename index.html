<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>FinaS ‚Äî Controle Inteligente</title>
<meta name="description" content="Controle financeiro inteligente com IA">
<meta name="theme-color" content="#e84c2b">

<!-- PWA -->

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="FinaS">

<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,300;400;500;600;700;800&family=Inconsolata:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>

<!-- ============================================================
  üî• FIREBASE CONFIG ‚Äî COLE SUAS CREDENCIAIS AQUI
============================================================ -->

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700;9..40,800&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f7f7f8;--surface:#fff;--surface2:#f1f1f3;
  --border:#e5e5ea;--border2:#ccccd4;
  --text:#0f0f12;--muted:#8a8a96;--muted2:#b8b8c4;
  --accent:#7c6ff7;--accent-soft:rgba(124,111,247,0.10);--accent-glow:rgba(124,111,247,0.30);
  --green:#22c55e;--green-soft:rgba(34,197,94,0.10);
  --red:#ef4444;--red-soft:rgba(239,68,68,0.10);
  --orange:#f97316;--orange-soft:rgba(249,115,22,0.10);
  --shadow-sm:0 1px 3px rgba(0,0,0,0.06);
  --shadow:0 4px 16px rgba(0,0,0,0.07);
  --shadow-lg:0 12px 40px rgba(0,0,0,0.12);
  --r:16px;--r-sm:10px;
}
html{scroll-behavior:smooth;height:100%}

/* SVG global defaults */
svg{stroke-linecap:round;stroke-linejoin:round}

.bn-item.active
.mc-icon svg{width:18px;height:18px;stroke-width:2}
.drawer-nav-item svg{stroke:var(‚Äìmuted);transition:stroke 0.2s}
.drawer-nav-item.active svg{stroke:var(‚Äìaccent)}
.month-nav svg{stroke:currentColor;width:18px;height:18px}
.tb .ti svg{width:20px;height:20px;stroke-width:1.8}
.rb svg{width:15px;height:15px;stroke-width:1.8}
.btn-sm svg{width:13px;height:13px}
.fb svg{width:13px;height:13px}
.lock-icon svg{stroke:var(‚Äìaccent)}
.support-item svg{stroke:var(‚Äìmuted)}
.support-item:hover svg{stroke:var(‚Äìaccent)}
body{background:var(‚Äìbg);color:var(‚Äìtext);font-family:‚ÄòDM Sans‚Äô,system-ui,sans-serif;min-height:100vh;font-size:14px;line-height:1.5;-webkit-font-smoothing:antialiased;position:relative}

/* NOISE TEXTURE */
body::before{content:‚Äô‚Äô;position:fixed;inset:0;pointer-events:none;z-index:9998;opacity:0.018;
background-image:url(‚Äúdata:image/svg+xml,%3Csvg viewBox=‚Äò0 0 256 256‚Äô xmlns=‚Äòhttp://www.w3.org/2000/svg‚Äô%3E%3Cfilter id=‚Äònoise‚Äô%3E%3CfeTurbulence type=‚ÄòfractalNoise‚Äô baseFrequency=‚Äò0.9‚Äô numOctaves=‚Äò4‚Äô stitchTiles=‚Äòstitch‚Äô/%3E%3C/filter%3E%3Crect width=‚Äò100%25‚Äô height=‚Äò100%25‚Äô filter=‚Äòurl(%23noise)‚Äô/%3E%3C/svg%3E‚Äù);
background-size:180px 180px}

@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}
@keyframes ripple{0%{transform:scale(0);opacity:0.4}100%{transform:scale(2.5);opacity:0}}
@keyframes slideLeft{from{transform:translateX(0)}to{transform:translateX(-80px)}}
@keyframes popIn{0%{opacity:0;transform:scale(0.95) translateY(8px)}100%{opacity:1;transform:scale(1) translateY(0)}}

/* RIPPLE */
.ripple-wrap{position:relative;overflow:hidden}
.ripple-wrap::after{content:‚Äô‚Äô;position:absolute;border-radius:50%;background:rgba(124,111,247,0.18);width:100px;height:100px;left:50%;top:50%;transform:scale(0);animation:none;pointer-events:none;margin-left:-50px;margin-top:-50px}
.ripple-wrap.rippling::after{animation:ripple 0.5s ease-out forwards}

/* LOADING */
#loading-overlay{position:fixed;inset:0;background:rgba(247,247,248,0.96);z-index:9999;display:none;flex-direction:column;align-items:center;justify-content:center;gap:14px;backdrop-filter:blur(4px)}
.loading-spinner{width:30px;height:30px;border:2.5px solid var(‚Äìborder2);border-top-color:var(‚Äìaccent);border-radius:50%;animation:spin 0.7s linear infinite}
#loading-msg{font-size:13px;color:var(‚Äìmuted);font-weight:500}

/* ‚îÄ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ */
#auth-screen{position:fixed;inset:0;background:var(‚Äìbg);z-index:100;display:flex;align-items:center;justify-content:center;padding:24px;overflow-y:auto}
.auth-wrap{width:100%;max-width:380px;animation:fadeUp 0.4s ease}
.auth-logo{font-size:44px;font-weight:800;text-align:center;margin-bottom:4px;letter-spacing:-2.5px}
.auth-logo span{color:var(‚Äìaccent)}
.auth-tagline{text-align:center;font-size:11px;color:var(‚Äìmuted);letter-spacing:2px;text-transform:uppercase;margin-bottom:30px;font-weight:600}
.auth-card{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:24px;padding:26px;box-shadow:var(‚Äìshadow-lg)}
.auth-tabs{display:flex;gap:3px;background:var(‚Äìsurface2);border-radius:12px;padding:3px;margin-bottom:20px}
.auth-tab{flex:1;text-align:center;padding:9px;border-radius:9px;cursor:pointer;font-size:13px;font-weight:500;transition:all 0.2s;color:var(‚Äìmuted)}
.auth-tab-active{background:var(‚Äìsurface);color:var(‚Äìtext);box-shadow:var(‚Äìshadow-sm);font-weight:700}
.btn-google{width:100%;padding:13px;background:var(‚Äìsurface);color:var(‚Äìtext);border:1.5px solid var(‚Äìborder);border-radius:12px;cursor:pointer;font-weight:600;font-size:13px;transition:all 0.22s;margin-bottom:16px;display:flex;align-items:center;justify-content:center;gap:10px;font-family:inherit}
.btn-google:hover{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft);transform:translateY(-1px)}
.btn-google:active{transform:translateY(0)}
.auth-divider{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.auth-divider span{font-size:11px;color:var(‚Äìmuted2);font-weight:500}
.auth-divider::before,.auth-divider::after{content:‚Äô‚Äô;flex:1;height:1px;background:var(‚Äìborder)}
.auth-field{margin-bottom:11px}
.auth-field label{display:block;font-size:10px;font-weight:700;color:var(‚Äìmuted);margin-bottom:4px;letter-spacing:0.5px;text-transform:uppercase}
.auth-field input{width:100%;padding:12px 14px;border:1.5px solid var(‚Äìborder);border-radius:10px;font-family:inherit;font-size:14px;background:var(‚Äìbg);color:var(‚Äìtext);outline:none;transition:all 0.2s}
.auth-field input:focus{border-color:var(‚Äìaccent);background:var(‚Äìsurface);box-shadow:0 0 0 3px var(‚Äìaccent-soft)}
.btn-auth{width:100%;padding:13px;background:#7c6ff7!important;color:#fff!important;border:none;border-radius:12px;cursor:pointer;font-family:inherit;font-weight:700;font-size:14px;transition:all 0.22s;margin-top:4px}
.btn-auth:hover{opacity:0.9;transform:translateY(-1px);box-shadow:0 6px 18px var(‚Äìaccent-glow)}
.btn-auth:active{transform:translateY(0)}
.auth-link{background:none;border:none;color:var(‚Äìaccent);cursor:pointer;font-size:12px;font-family:inherit;margin-top:10px;display:block;text-align:center;font-weight:500}
.auth-benefits{margin-top:18px;display:flex;flex-direction:column;gap:7px}
.ab-item{display:flex;align-items:center;gap:8px;font-size:12px;color:var(‚Äìmuted);font-weight:500}

/* ‚îÄ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ‚îÄ */
#onboard-screen{position:fixed;inset:0;background:var(‚Äìbg);z-index:100;display:none;align-items:center;justify-content:center;padding:24px;overflow-y:auto}
.ob-wrap{width:100%;max-width:440px;animation:fadeUp 0.3s ease}
.ob-header{text-align:center;margin-bottom:16px}
.ob-logo{font-size:28px;font-weight:800;letter-spacing:-1.5px}.ob-logo span{color:var(‚Äìaccent)}
.ob-card{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:24px;padding:24px;box-shadow:var(‚Äìshadow-lg)}
.ob-step{display:none}.ob-step.active{display:block;animation:fadeUp 0.28s ease}
.step-indicator{display:flex;gap:5px;margin-bottom:16px}
.si-dot{height:3px;border-radius:2px;background:var(‚Äìborder);transition:all 0.3s;flex:1}
.si-dot.done{background:var(‚Äìgreen)}.si-dot.active{background:var(‚Äìaccent)}
.ob-q{font-size:19px;font-weight:800;margin-bottom:4px;letter-spacing:-0.3px}
.ob-hint{font-size:13px;color:var(‚Äìmuted);margin-bottom:14px;line-height:1.6;font-weight:500}
.pg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px}
.pc{border:1.5px solid var(‚Äìborder);border-radius:14px;padding:14px;cursor:pointer;transition:all 0.18s;background:var(‚Äìsurface)}
.pc:hover{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft);transform:translateY(-1px)}
.pc.sel{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}
.pc-icon{font-size:22px;margin-bottom:5px}.pc-name{font-size:13px;font-weight:700}.pc-desc{font-size:11px;color:var(‚Äìmuted);margin-top:2px;line-height:1.4}
.ob-field{margin-bottom:11px}.ob-field label{display:block;font-size:10px;font-weight:700;color:var(‚Äìmuted);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px}
.ob-field input,.ob-field select{width:100%;padding:11px 13px;border:1.5px solid var(‚Äìborder);border-radius:10px;font-family:inherit;font-size:13px;background:var(‚Äìbg);color:var(‚Äìtext);outline:none;transition:all 0.2s}
.ob-field input:focus,.ob-field select:focus{border-color:var(‚Äìaccent);background:var(‚Äìsurface);box-shadow:0 0 0 3px var(‚Äìaccent-soft)}
.ob-grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.freq-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px}
.fq-btn{border:1.5px solid var(‚Äìborder);border-radius:12px;padding:12px;text-align:center;cursor:pointer;transition:all 0.18s;background:var(‚Äìsurface)}
.fq-btn:hover{border-color:var(‚Äìaccent)}.fq-btn.sel{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}
.fq-icon{font-size:18px;margin-bottom:3px}.fq-name{font-size:12px;font-weight:700}.fq-desc{font-size:10px;color:var(‚Äìmuted)}
.obj-list{display:flex;flex-direction:column;gap:7px;margin-bottom:14px}
.obj-item{border:1.5px solid var(‚Äìborder);border-radius:12px;padding:12px 14px;cursor:pointer;transition:all 0.18s;background:var(‚Äìsurface);display:flex;align-items:center;gap:10px}
.obj-item:hover{border-color:var(‚Äìaccent)}.obj-item.sel{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}
.obj-icon{font-size:18px;flex-shrink:0}.obj-name{font-size:13px;font-weight:700}.obj-sub{font-size:11px;color:var(‚Äìmuted)}
.btn-ob-next{width:100%;padding:13px;background:#7c6ff7!important;color:#fff!important;border:none;border-radius:12px;cursor:pointer;font-family:inherit;font-weight:700;font-size:14px;transition:all 0.2s}
.btn-ob-next:hover{opacity:0.9;transform:translateY(-1px)}
.btn-ob-back{background:none;border:none;color:var(‚Äìmuted);cursor:pointer;font-size:12px;font-family:inherit;margin-top:9px;display:block;text-align:center;font-weight:500}

/* ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ */
#app-screen{display:none;min-height:100vh;padding-bottom:96px}
.app-header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px 0;position:sticky;top:0;z-index:50;background:rgba(247,247,248,0.88);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px)}
.hl-logo{font-size:22px;font-weight:800;letter-spacing:-1px}
.hl-logo span{color:var(‚Äìaccent)}
.hl-greeting{font-size:12px;color:var(‚Äìmuted);font-weight:500;margin-top:1px}
.header-right{display:flex;align-items:center;gap:8px}
.plan-badge{display:inline-flex;align-items:center;gap:5px;font-size:11px;padding:5px 11px;border-radius:20px;font-weight:700;cursor:pointer;border:1.5px solid;transition:all 0.2s}
.plan-badge:hover{transform:translateY(-1px)}
.plan-badge.free{background:var(‚Äìorange-soft);border-color:var(‚Äìorange);color:var(‚Äìorange)}
.plan-badge.pro{background:var(‚Äìaccent-soft);border-color:var(‚Äìaccent);color:var(‚Äìaccent)}
.btn-avatar{width:36px;height:36px;border-radius:50%;background:var(‚Äìaccent-soft);border:2px solid var(‚Äìaccent);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;font-weight:800;color:var(‚Äìaccent);transition:all 0.2s}
.btn-avatar:hover{transform:scale(1.06)}

/* TRIAL BANNER */
.trial-banner{background:linear-gradient(135deg,var(‚Äìorange-soft),var(‚Äìaccent-soft));border:1.5px solid var(‚Äìorange);border-radius:14px;padding:11px 15px;margin:12px 20px 0;display:flex;align-items:center;justify-content:space-between;gap:10px}
.trial-banner-text{font-size:12px;font-weight:500}
.trial-banner-text strong{color:var(‚Äìorange)}
.btn-trial-upgrade{padding:6px 12px;background:var(‚Äìorange);color:#fff;border:none;border-radius:8px;cursor:pointer;font-family:inherit;font-weight:700;font-size:11px;white-space:nowrap;transition:all 0.2s}
.btn-trial-upgrade:hover{opacity:0.9}

/* ‚îÄ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ‚îÄ */

/* Nav icon fix ‚Äî explicit stroke always visible */
.bn-icon-wrap{background:transparent;transition:background 0.25s cubic-bezier(0.34,1.56,0.64,1),box-shadow 0.25s,transform 0.25s cubic-bezier(0.34,1.56,0.64,1)}
.bn-icon-wrap svg{display:block;width:22px;height:22px;stroke:var(‚Äìmuted);stroke-width:1.8px;fill:none;stroke-linecap:round;stroke-linejoin:round;transition:stroke 0.22s}
.bn-item.active .bn-icon-wrap{background:#7c6ff7;box-shadow:0 4px 20px rgba(124,111,247,0.38);transform:translateY(-2px) scale(1.04)}
.bn-item.active .bn-icon-wrap svg{stroke:#ffffff}
.bn-item:not(.active):hover .bn-icon-wrap{background:rgba(124,111,247,0.08)}
.bn-item:not(.active):hover .bn-icon-wrap svg{stroke:#7c6ff7}
.bn-label{font-size:10px;font-weight:600;color:var(‚Äìmuted);transition:color 0.22s;letter-spacing:0.2px;margin-top:2px}
.bn-item.active .bn-label{color:#7c6ff7;font-weight:700}

.bottom-nav-wrap{position:fixed;bottom:0;left:0;right:0;z-index:200;padding:10px 18px max(18px,env(safe-area-inset-bottom));pointer-events:none}
.bottom-nav{
background:rgba(255,255,255,0.92);
border-radius:28px;padding:7px;
display:flex;align-items:center;justify-content:space-around;
box-shadow:0 2px 40px rgba(0,0,0,0.10),0 0 0 1px var(‚Äìborder);
pointer-events:all;max-width:480px;margin:0 auto;
backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px)
}
.bn-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;border-radius:20px;padding:9px 4px;transition:all 0.22s;user-select:none;-webkit-tap-highlight-color:transparent}

.bn-item.active
.bn-item.active

.bn-item:active

/* ‚îÄ‚îÄ‚îÄ PANELS ‚îÄ‚îÄ‚îÄ */
.panel{display:none;animation:fadeUp 0.26s ease}.panel.active{display:block}
.panel-inner{padding:16px 20px}

/* HOME */
.month-selector{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.month-nav{background:var(‚Äìsurface2);border:none;border-radius:10px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;color:var(‚Äìmuted)}
.month-nav svg{width:18px;height:18px;stroke:currentColor;stroke-width:2}
.month-nav:hover{background:var(‚Äìborder2);color:var(‚Äìtext);transform:scale(1.05)}
.month-nav:active{transform:scale(0.95)}
.month-info{text-align:center}
.month-name{font-size:17px;font-weight:800;letter-spacing:-0.3px}
.month-tag{font-size:11px;color:var(‚Äìmuted);font-weight:600;margin-top:1px}
.month-tag.atual{color:var(‚Äìaccent)}

.summary-card{background:var(‚Äìsurface);border-radius:22px;padding:22px;margin-bottom:12px;box-shadow:var(‚Äìshadow);border:1px solid var(‚Äìborder);overflow:hidden;position:relative;transition:transform 0.2s,box-shadow 0.2s}
.summary-card:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,0.09)}
.sc-bar{position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(‚Äìaccent),var(‚Äìgreen))}
.sc-label{font-size:11px;font-weight:700;color:var(‚Äìmuted);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.sc-value{font-size:34px;font-weight:800;letter-spacing:-1.5px;line-height:1;margin-bottom:3px}
.sc-value.red{color:var(‚Äìred)}.sc-value.green{color:var(‚Äìgreen)}
.sc-sub{font-size:12px;color:var(‚Äìmuted);font-weight:500}

.mini-cards{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.mini-card{background:var(‚Äìsurface);border-radius:18px;padding:16px;box-shadow:var(‚Äìshadow);border:1px solid var(‚Äìborder);transition:all 0.2s;cursor:default}
.mini-card:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.09)}
.mc-icon{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:9px}
.mc-icon svg{width:16px;height:16px}
.mc-icon.green{background:var(‚Äìgreen-soft)}.mc-icon.green svg{stroke:var(‚Äìgreen)}
.mc-icon.red{background:var(‚Äìred-soft)}.mc-icon.red svg{stroke:var(‚Äìred)}
.mc-icon.accent{background:var(‚Äìaccent-soft)}.mc-icon.accent svg{stroke:var(‚Äìaccent)}
.mc-icon.orange{background:var(‚Äìorange-soft)}.mc-icon.orange svg{stroke:var(‚Äìorange)}
.mc-label{font-size:10px;color:var(‚Äìmuted);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px}
.mc-value{font-size:18px;font-weight:800;letter-spacing:-0.5px}
.mc-value.red{color:var(‚Äìred)}.mc-value.green{color:var(‚Äìgreen)}.mc-value.accent{color:var(‚Äìaccent)}.mc-value.orange{color:var(‚Äìorange)}
.mc-sub{font-size:10px;color:var(‚Äìmuted);margin-top:2px;font-weight:500}

.progress-card{background:var(‚Äìsurface);border-radius:18px;padding:16px;margin-bottom:12px;box-shadow:var(‚Äìshadow);border:1px solid var(‚Äìborder)}
.pc-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.pc-title{font-size:13px;font-weight:700}.pc-pct{font-size:14px;font-weight:800;color:var(‚Äìaccent)}
.progress-track{height:8px;background:var(‚Äìsurface2);border-radius:4px;position:relative}
.progress-fill{height:100%;border-radius:4px;transition:width 0.8s cubic-bezier(0.4,0,0.2,1),background 0.4s;position:relative}
.progress-fill::after{content:‚Äô‚Äô;position:absolute;right:-1px;top:50%;transform:translateY(-50%);width:16px;height:16px;border-radius:50%;background:inherit;border:2.5px solid white;box-shadow:0 2px 6px rgba(0,0,0,0.15)}
.pc-legend{display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
.pcl-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(‚Äìmuted);font-weight:500}
.pcl-dot{width:7px;height:7px;border-radius:50%}

.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:11px}
.section-title{font-size:15px;font-weight:800;letter-spacing:-0.2px}
.btn-sm{background:none;border:1.5px solid var(‚Äìborder);border-radius:8px;padding:5px 12px;cursor:pointer;font-size:11px;color:var(‚Äìmuted);font-family:inherit;font-weight:700;transition:all 0.2s;display:flex;align-items:center;gap:5px}
.btn-sm svg{width:12px;height:12px;stroke:currentColor}
.btn-sm:hover{border-color:var(‚Äìaccent);color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}

.meta-item{background:var(‚Äìsurface);border-radius:14px;padding:14px;border:1px solid var(‚Äìborder);margin-bottom:8px;transition:all 0.2s}
.mi-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:5px}
.mi-name{font-size:13px;font-weight:700}
.mi-status{font-size:10px;padding:3px 8px;border-radius:20px;font-weight:700}
.mi-status.ok{background:var(‚Äìgreen-soft);color:var(‚Äìgreen)}.mi-status.warn{background:var(‚Äìorange-soft);color:var(‚Äìorange)}.mi-status.fail{background:var(‚Äìred-soft);color:var(‚Äìred)}
.mi-vals{font-size:11px;color:var(‚Äìmuted);margin-bottom:6px;font-weight:500}
.mi-bar-track{height:4px;background:var(‚Äìsurface2);border-radius:2px;overflow:hidden}
.mi-bar-fill{height:100%;border-radius:2px;transition:width 0.5s}
.mi-del{background:none;border:none;cursor:pointer;color:var(‚Äìmuted2);padding:2px;transition:color 0.2s;font-family:inherit}
.mi-del:hover{color:var(‚Äìred)}

.meta-form-inline{background:var(‚Äìsurface2);border:1.5px dashed var(‚Äìborder2);border-radius:14px;padding:14px;margin-top:8px;display:none}
.meta-form-inline.show{display:block;animation:fadeUp 0.2s ease}
.mf-grid{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:8px;align-items:end}
.mf-grid .fg label{font-size:10px;font-weight:700;color:var(‚Äìmuted);margin-bottom:3px;display:block;text-transform:uppercase;letter-spacing:0.5px}
.mf-grid .fg input,.mf-grid .fg select{padding:8px 10px;border:1.5px solid var(‚Äìborder);border-radius:8px;font-family:inherit;font-size:12px;background:var(‚Äìsurface);color:var(‚Äìtext);outline:none;width:100%}
.mf-grid .fg input:focus{border-color:var(‚Äìaccent)}
.btn-meta-save{padding:8px 12px;background:var(‚Äìaccent);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:11px;font-family:inherit;white-space:nowrap;transition:all 0.2s}
.btn-meta-save:hover{opacity:0.9}

/* ‚îÄ‚îÄ‚îÄ LAN√áAMENTOS ‚îÄ‚îÄ‚îÄ */
.tipo-select{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px}
.tb{border:1.5px solid var(‚Äìborder);border-radius:12px;padding:10px 4px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(‚Äìsurface)}
.tb:hover{border-color:var(‚Äìaccent);transform:translateY(-1px)}
.tb:active{transform:scale(0.96)}
.tb.sel-gasto{border-color:var(‚Äìred);background:var(‚Äìred-soft)}
.tb.sel-recebimento{border-color:var(‚Äìgreen);background:var(‚Äìgreen-soft)}
.tb.sel-divida{border-color:var(‚Äìorange);background:var(‚Äìorange-soft)}
.tb.sel-investimento{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}
.tb .ti{display:flex;justify-content:center;margin-bottom:4px}.tb .ti svg{width:18px;height:18px;stroke:var(‚Äìmuted);transition:stroke 0.2s}
.tb.sel-gasto .ti svg{stroke:var(‚Äìred)}.tb.sel-recebimento .ti svg{stroke:var(‚Äìgreen)}
.tb.sel-divida .ti svg{stroke:var(‚Äìorange)}.tb.sel-investimento .ti svg{stroke:var(‚Äìaccent)}
.tb .tn{font-size:10px;font-weight:700;color:var(‚Äìmuted)}

.recorr-select{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:12px}
.rb{border:1.5px solid var(‚Äìborder);border-radius:12px;padding:11px;text-align:center;cursor:pointer;transition:all 0.2s;background:var(‚Äìsurface);font-size:12px;font-weight:600;color:var(‚Äìmuted);display:flex;align-items:center;justify-content:center;gap:7px}
.rb svg{width:14px;height:14px;stroke:currentColor;transition:all 0.2s}
.rb:hover{border-color:var(‚Äìaccent)}.rb.sel{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft);color:var(‚Äìaccent)}

.form-card{background:var(‚Äìsurface);border-radius:20px;padding:18px;margin-bottom:12px;box-shadow:var(‚Äìshadow);border:1px solid var(‚Äìborder)}
.form-card-title{font-size:15px;font-weight:800;margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;letter-spacing:-0.2px}
.form-card-tag{font-size:11px;font-weight:500;color:var(‚Äìmuted);background:var(‚Äìsurface2);padding:3px 8px;border-radius:6px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.form-row.tri{grid-template-columns:1fr 1fr 1fr}
.fg{display:flex;flex-direction:column;gap:4px}
.fg label{font-size:10px;font-weight:700;color:var(‚Äìmuted);text-transform:uppercase;letter-spacing:0.5px}
.fg input,.fg select{padding:11px 13px;border:1.5px solid var(‚Äìborder);border-radius:10px;font-family:inherit;font-size:13px;background:var(‚Äìbg);color:var(‚Äìtext);outline:none;transition:all 0.2s}
.fg input:focus,.fg select:focus{border-color:var(‚Äìaccent);background:var(‚Äìsurface);box-shadow:0 0 0 3px var(‚Äìaccent-soft)}
.parc-toggle{display:flex;align-items:center;gap:9px;padding:11px 13px;background:var(‚Äìsurface2);border:1.5px solid var(‚Äìborder);border-radius:10px;cursor:pointer;transition:all 0.2s;margin-bottom:10px;user-select:none}
.parc-toggle:hover{border-color:var(‚Äìaccent)}.parc-toggle input{accent-color:var(‚Äìaccent);width:14px;height:14px}
.parc-toggle-lbl{font-size:12px;color:var(‚Äìmuted);flex:1;font-weight:500}.parc-toggle-lbl strong{color:var(‚Äìtext)}
.parc-fields{display:none}.parc-fields.show{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:10px;animation:fadeUp 0.2s ease}
.btn-save{width:100%;padding:13px;background:#7c6ff7!important;color:#fff!important;border:none;border-radius:12px;cursor:pointer;font-family:inherit;font-weight:700;font-size:14px;transition:all 0.22s;letter-spacing:0.1px}
.btn-save:hover{opacity:0.9;transform:translateY(-1px);box-shadow:0 6px 18px var(‚Äìaccent-glow)}
.btn-save:active{transform:translateY(0);opacity:1}

/* FILTER */
.filter-row{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;padding-bottom:2px}
.filter-row::-webkit-scrollbar{display:none}
.fb{padding:6px 14px;border-radius:20px;border:1.5px solid var(‚Äìborder);background:var(‚Äìsurface);cursor:pointer;font-size:12px;font-family:inherit;font-weight:600;transition:all 0.2s;color:var(‚Äìmuted);white-space:nowrap;display:flex;align-items:center;gap:5px}
.fb svg{width:13px;height:13px;stroke:currentColor}
.fb.active,.fb:hover{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft);color:var(‚Äìaccent)}

/* LISTA DE ITENS */
.lista-group-header{display:flex;justify-content:space-between;align-items:center;padding:6px 2px;margin:10px 0 5px}
.lgh-left{display:flex;align-items:center;gap:6px}
.lgh-icon{width:24px;height:24px;border-radius:8px;display:flex;align-items:center;justify-content:center}
.lgh-icon svg{width:12px;height:12px}
.lgh-label{font-size:11px;font-weight:700;color:var(‚Äìmuted);text-transform:uppercase;letter-spacing:0.5px}
.lgh-total{font-size:14px;font-weight:800}
.gastos-lista{display:flex;flex-direction:column;gap:6px}

/* SWIPE ITEM */
.gi-wrapper{position:relative;border-radius:14px;overflow:hidden}
.gi-actions{position:absolute;right:0;top:0;bottom:0;display:flex;align-items:stretch;border-radius:0 14px 14px 0;overflow:hidden;opacity:0;transition:opacity 0.2s}
.gi-action-btn{display:flex;align-items:center;justify-content:center;width:60px;border:none;cursor:pointer;font-size:13px;font-weight:700;font-family:inherit;transition:all 0.2s;flex-direction:column;gap:3px}
.gi-action-btn svg{width:18px;height:18px;stroke:#fff;stroke-width:2}
.gi-action-btn span{font-size:10px;font-weight:700;color:#fff}
.gi-action-edit{background:var(‚Äìaccent)}
.gi-action-edit:hover{background:#6558e8}
.gi-action-delete{background:var(‚Äìred)}
.gi-action-delete:hover{background:#dc2626}
.gi{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:14px;padding:13px;display:flex;align-items:center;gap:11px;transition:transform 0.25s cubic-bezier(0.4,0,0.2,1),box-shadow 0.2s;cursor:grab;user-select:none;touch-action:pan-y;will-change:transform;position:relative;z-index:1}
.gi.swiping{cursor:grabbing}
.gi.swiped{transform:translateX(-120px);box-shadow:none}
.gi-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.gi-icon svg{width:17px;height:17px}
.gi-body{flex:1;min-width:0}
.gi-title{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px}
.gi-meta{font-size:11px;color:var(‚Äìmuted);display:flex;gap:6px;flex-wrap:wrap;align-items:center;font-weight:500}
.gi-badge{display:inline-flex;align-items:center;gap:3px;font-size:10px;padding:2px 7px;border-radius:20px;border:1.5px solid;font-weight:600}
.gi-right{text-align:right;flex-shrink:0}
.gi-val{font-size:15px;font-weight:800;letter-spacing:-0.3px}
.gi-parc{font-size:10px;color:var(‚Äìmuted);margin-top:1px;font-weight:500}
.pp-bar{height:3px;background:var(‚Äìsurface2);border-radius:2px;margin-top:5px;overflow:hidden}
.pp-fill{height:100%;border-radius:2px;background:var(‚Äìorange)}
.expired-tag{font-size:10px;background:var(‚Äìgreen-soft);color:var(‚Äìgreen);border:1.5px solid var(‚Äìgreen);padding:2px 7px;border-radius:20px;font-weight:600}

/* SWIPE HINT */
.swipe-hint{font-size:11px;color:var(‚Äìmuted2);text-align:center;padding:8px;font-weight:500;display:flex;align-items:center;justify-content:center;gap:5px}
.swipe-hint svg{width:13px;height:13px;stroke:var(‚Äìmuted2)}

/* ‚îÄ‚îÄ‚îÄ MODAL EDITAR ‚îÄ‚îÄ‚îÄ */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);z-index:800;opacity:0;pointer-events:none;transition:opacity 0.28s;backdrop-filter:blur(3px)}
.modal-overlay.open{opacity:1;pointer-events:all}
.modal{position:fixed;bottom:0;left:0;right:0;background:var(‚Äìsurface);border-radius:24px 24px 0 0;z-index:801;transform:translateY(100%);transition:transform 0.32s cubic-bezier(0.4,0,0.2,1);max-height:90vh;overflow-y:auto;box-shadow:0 -4px 40px rgba(0,0,0,0.12)}
.modal.open{transform:translateY(0);animation:popIn 0.32s ease}
.modal-handle{width:36px;height:4px;background:var(‚Äìborder2);border-radius:2px;margin:12px auto 0}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(‚Äìborder)}
.modal-title{font-size:16px;font-weight:800;letter-spacing:-0.3px}
.btn-modal-close{background:var(‚Äìsurface2);border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;color:var(‚Äìmuted)}
.btn-modal-close svg{width:14px;height:14px;stroke:currentColor}
.btn-modal-close:hover{background:var(‚Äìred-soft);color:var(‚Äìred)}
.modal-body{padding:20px}

/* ‚îÄ‚îÄ‚îÄ AN√ÅLISE ‚îÄ‚îÄ‚îÄ */
.analise-card{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:20px;padding:18px;margin-bottom:12px;box-shadow:var(‚Äìshadow)}
.ac-title{font-size:15px;font-weight:800;margin-bottom:13px;letter-spacing:-0.2px;display:flex;align-items:center;gap:8px}
.ac-title svg{width:16px;height:16px;stroke:var(‚Äìaccent)}
.perfil-box{background:var(‚Äìsurface2);border-radius:12px;padding:13px;font-size:13px;line-height:1.8;color:var(‚Äìmuted);margin-bottom:13px;font-weight:500}
.insight{display:flex;gap:11px;padding:12px;border-radius:12px;border:1.5px solid;margin-bottom:8px}
.insight.ok{background:var(‚Äìgreen-soft);border-color:rgba(34,197,94,0.2)}
.insight.warn{background:var(‚Äìorange-soft);border-color:rgba(249,115,22,0.2)}
.insight.crit{background:var(‚Äìred-soft);border-color:rgba(239,68,68,0.2)}
.insight.dica{background:var(‚Äìaccent-soft);border-color:rgba(124,111,247,0.2)}
.in-icon{width:20px;height:20px;flex-shrink:0;margin-top:1px}
.in-icon svg{width:16px;height:16px}
.in-title{font-size:12px;font-weight:700;margin-bottom:3px}
.in-desc{font-size:12px;color:var(‚Äìmuted);line-height:1.6;font-weight:500}

.chart-section{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:20px;padding:18px;margin-bottom:12px;box-shadow:var(‚Äìshadow);position:relative}
.chart-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:13px}
.chart-title{font-size:15px;font-weight:800;letter-spacing:-0.2px;display:flex;align-items:center;gap:7px}
.chart-title svg{width:16px;height:16px;stroke:var(‚Äìaccent)}
.chart-legend{display:flex;gap:10px;flex-wrap:wrap}
.cl-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(‚Äìmuted);font-weight:500}
.cl-dot{width:8px;height:8px;border-radius:50%}
.chart-wrap{position:relative;height:200px}
.chart-months-summary{display:grid;grid-template-columns:repeat(auto-fill,minmax(68px,1fr));gap:6px;margin-top:13px}
.cms-item{background:var(‚Äìsurface2);border-radius:10px;padding:9px;text-align:center}
.cms-month{font-size:10px;color:var(‚Äìmuted);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:3px}
.cms-val{font-size:12px;font-weight:800}.cms-val.pos{color:var(‚Äìgreen)}.cms-val.neg{color:var(‚Äìred)}
.lock-overlay{position:absolute;inset:0;background:rgba(247,247,248,0.9);border-radius:inherit;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:10;backdrop-filter:blur(3px)}
.lock-icon{width:40px;height:40px;border-radius:14px;background:var(‚Äìaccent-soft);display:flex;align-items:center;justify-content:center;margin-bottom:10px}
.lock-icon svg{width:20px;height:20px;stroke:var(‚Äìaccent)}
.lock-text{font-size:13px;font-weight:700;margin-bottom:11px;text-align:center;padding:0 20px}
.btn-unlock{padding:9px 18px;background:var(‚Äìaccent);color:#fff;border:none;border-radius:10px;cursor:pointer;font-family:inherit;font-weight:700;font-size:12px;transition:all 0.2s}
.btn-unlock:hover{opacity:0.9}

/* ‚îÄ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ‚îÄ */
.chat-wrap{background:var(‚Äìsurface);border:1px solid var(‚Äìborder);border-radius:20px;overflow:hidden;display:flex;flex-direction:column;height:calc(100vh - 210px);min-height:400px;box-shadow:var(‚Äìshadow)}
.chat-header{padding:14px 18px;border-bottom:1px solid var(‚Äìborder);display:flex;align-items:center;justify-content:space-between}
.chat-header-left{display:flex;align-items:center;gap:10px}
.chat-ai-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,var(‚Äìaccent),#a855f7);display:flex;align-items:center;justify-content:center}
.chat-ai-avatar svg{width:20px;height:20px;stroke:#fff;stroke-width:1.8}
.chat-ai-name{font-size:14px;font-weight:800;letter-spacing:-0.2px}
.chat-ai-sub{font-size:11px;color:var(‚Äìmuted);font-weight:500}
#chat-counter{font-size:11px;color:var(‚Äìmuted);background:var(‚Äìsurface2);padding:4px 10px;border-radius:20px;font-weight:700}
.chat-list{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth}
.chat-msg{display:flex;max-width:88%}
.chat-user{align-self:flex-end;flex-direction:row-reverse}
.chat-ai{align-self:flex-start}
.chat-bubble{padding:11px 15px;border-radius:16px;font-size:13px;line-height:1.65;max-width:100%}
.chat-user .chat-bubble{background:var(‚Äìaccent);color:#fff;border-radius:16px 16px 4px 16px;font-weight:500}
.chat-ai .chat-bubble{background:var(‚Äìsurface2);color:var(‚Äìtext);border-radius:16px 16px 16px 4px;border:1px solid var(‚Äìborder)}
.chat-bubble.loading{display:flex;align-items:center;gap:5px;padding:13px 18px}
.dot{width:6px;height:6px;border-radius:50%;background:var(‚Äìmuted2);animation:bounce 1.2s ease infinite}
.dot:nth-child(2){animation-delay:0.2s}.dot:nth-child(3){animation-delay:0.4s}
.chat-input-wrap{padding:12px 14px;border-top:1px solid var(‚Äìborder);display:flex;gap:9px;align-items:flex-end}
#chat-input{flex:1;padding:10px 14px;border:1.5px solid var(‚Äìborder);border-radius:12px;font-family:inherit;font-size:13px;background:var(‚Äìbg);color:var(‚Äìtext);outline:none;resize:none;min-height:40px;max-height:100px;transition:all 0.2s;line-height:1.5}
#chat-input:focus{border-color:var(‚Äìaccent);background:var(‚Äìsurface);box-shadow:0 0 0 3px var(‚Äìaccent-soft)}
#chat-send{padding:10px 16px;background:var(‚Äìaccent);color:#fff;border:none;border-radius:11px;cursor:pointer;font-family:inherit;font-weight:700;font-size:13px;transition:all 0.2s;display:flex;align-items:center;gap:6px}
#chat-send svg{width:15px;height:15px;stroke:#fff;stroke-width:2}
#chat-send:hover{opacity:0.9;transform:translateY(-1px)}
#chat-send:disabled{opacity:0.4;cursor:not-allowed;transform:none}

/* ‚îÄ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ‚îÄ */
.drawer-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.22);z-index:900;opacity:0;pointer-events:none;transition:opacity 0.3s;backdrop-filter:blur(2px)}
.drawer-overlay.open{opacity:1;pointer-events:all}
.drawer{position:fixed;top:0;right:0;bottom:0;width:min(360px,100vw);background:var(‚Äìsurface);z-index:901;transform:translateX(100%);transition:transform 0.32s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-4px 0 40px rgba(0,0,0,0.10)}
.drawer.open{transform:translateX(0)}
.drawer-header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px;border-bottom:1px solid var(‚Äìborder);position:sticky;top:0;background:var(‚Äìsurface);z-index:1}
.drawer-title{font-size:16px;font-weight:800;letter-spacing:-0.3px}
.btn-drawer-close{background:var(‚Äìsurface2);border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;color:var(‚Äìmuted)}
.btn-drawer-close svg{width:14px;height:14px;stroke:currentColor}
.btn-drawer-close:hover{background:var(‚Äìred-soft);color:var(‚Äìred)}
.drawer-body{padding:18px}
.drawer-nav{display:flex;flex-direction:column;gap:3px;margin-bottom:18px}
.drawer-nav-item{display:flex;align-items:center;gap:11px;padding:11px 13px;border-radius:12px;cursor:pointer;transition:all 0.2s;font-size:13px;font-weight:600;border:none;background:none;width:100%;text-align:left;color:var(‚Äìtext)}
.drawer-nav-item svg{width:16px;height:16px;stroke:currentColor;flex-shrink:0}
.drawer-nav-item:hover{background:var(‚Äìsurface2)}
.drawer-nav-item.active{background:var(‚Äìaccent-soft);color:var(‚Äìaccent)}
.drawer-nav-item .dna{margin-left:auto;font-size:10px;color:var(‚Äìmuted);font-weight:700;background:var(‚Äìsurface2);padding:2px 7px;border-radius:6px}
.drawer-section{display:none;animation:fadeUp 0.22s ease}.drawer-section.active{display:block}
.ds-title{font-size:15px;font-weight:800;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(‚Äìborder);letter-spacing:-0.2px}
.pf-field{margin-bottom:10px}.pf-field label{display:block;font-size:10px;font-weight:700;color:var(‚Äìmuted);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.5px}
.pf-field input,.pf-field select{width:100%;padding:10px 13px;border:1.5px solid var(‚Äìborder);border-radius:10px;font-family:inherit;font-size:13px;background:var(‚Äìbg);color:var(‚Äìtext);outline:none;transition:all 0.2s}
.pf-field input:focus,.pf-field select:focus{border-color:var(‚Äìaccent);background:var(‚Äìsurface);box-shadow:0 0 0 3px var(‚Äìaccent-soft)}
.pf-grid2{display:grid;grid-template-columns:1fr 1fr;gap:9px}
.btn-save-profile{width:100%;padding:12px;background:var(‚Äìaccent);color:#fff;border:none;border-radius:11px;cursor:pointer;font-family:inherit;font-weight:700;font-size:13px;margin-top:6px;transition:all 0.2s}
.btn-save-profile:hover{opacity:0.9}

.plans-grid{display:flex;flex-direction:column;gap:12px}
.plan-card{border:1.5px solid var(‚Äìborder);border-radius:16px;padding:18px;position:relative}
.plan-card.featured{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft)}
.plan-badge-tag{position:absolute;top:12px;right:12px;background:var(‚Äìaccent);color:#fff;font-size:9px;font-weight:700;padding:3px 9px;border-radius:20px;letter-spacing:0.5px}
.plan-name{font-size:18px;font-weight:800;margin-bottom:3px;letter-spacing:-0.5px}
.plan-price{font-size:26px;font-weight:800;line-height:1;margin-bottom:4px;letter-spacing:-1px}
.plan-price span{font-size:13px;font-weight:400;color:var(‚Äìmuted)}
.plan-desc{font-size:12px;color:var(‚Äìmuted);margin-bottom:13px;line-height:1.6;font-weight:500}
.plan-features{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
.pf-item{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:500}
.pf-item.locked{color:var(‚Äìmuted2);text-decoration:line-through;opacity:0.6}
.btn-plan{width:100%;padding:11px;border-radius:10px;cursor:pointer;font-family:inherit;font-weight:700;font-size:13px;transition:all 0.2s;border:1.5px solid}
.btn-plan.free-btn{background:var(‚Äìsurface2);border-color:var(‚Äìborder);color:var(‚Äìtext)}
.btn-plan.pro-btn{background:var(‚Äìaccent);border-color:var(‚Äìaccent);color:#fff}
.btn-plan.pro-btn:hover{opacity:0.9;transform:translateY(-1px);box-shadow:0 4px 14px var(‚Äìaccent-glow)}
.trial-info-sm{text-align:center;font-size:11px;color:var(‚Äìmuted);margin-top:7px;font-weight:500}
.support-item{display:flex;align-items:center;gap:12px;padding:13px;border:1.5px solid var(‚Äìborder);border-radius:12px;margin-bottom:8px;cursor:pointer;transition:all 0.2s;text-decoration:none;color:var(‚Äìtext)}
.support-item svg{width:18px;height:18px;stroke:var(‚Äìmuted);flex-shrink:0;transition:stroke 0.2s}
.support-item:hover{border-color:var(‚Äìaccent);background:var(‚Äìaccent-soft);transform:translateY(-1px)}
.support-item:hover svg{stroke:var(‚Äìaccent)}
.support-title{font-size:13px;font-weight:700}.support-sub{font-size:11px;color:var(‚Äìmuted);font-weight:500}
.faq-item{border:1px solid var(‚Äìborder);border-radius:11px;margin-bottom:7px;overflow:hidden}
.faq-q{padding:12px 14px;cursor:pointer;font-size:12px;font-weight:700;display:flex;justify-content:space-between;transition:background 0.2s}
.faq-q:hover{background:var(‚Äìsurface2)}
.faq-a{display:none;padding:0 14px 12px;font-size:12px;color:var(‚Äìmuted);line-height:1.7;font-weight:500}.faq-a.open{display:block;animation:fadeUp 0.2s ease}
.sobre-logo{font-size:32px;font-weight:800;text-align:center;margin-bottom:3px;letter-spacing:-1.5px}.sobre-logo span{color:var(‚Äìaccent)}
.sobre-version{font-size:11px;color:var(‚Äìmuted);letter-spacing:2px;text-align:center;text-transform:uppercase;margin-bottom:14px;font-weight:600}
.sobre-text{font-size:12px;color:var(‚Äìmuted);line-height:1.8;margin-bottom:13px;font-weight:500}
.sobre-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:13px}
.ss-item{background:var(‚Äìsurface2);border-radius:12px;padding:12px;text-align:center}
.ss-val{font-size:20px;font-weight:800;color:var(‚Äìaccent)}.ss-lbl{font-size:11px;color:var(‚Äìmuted);font-weight:500}
.sobre-links{display:flex;gap:7px}
.sobre-link{flex:1;padding:10px;border:1.5px solid var(‚Äìborder);border-radius:10px;text-align:center;font-size:11px;color:var(‚Äìmuted);cursor:pointer;transition:all 0.2s;background:none;font-family:inherit;font-weight:600}
.sobre-link:hover{border-color:var(‚Äìaccent);color:var(‚Äìaccent)}
.arquivo-item{background:var(‚Äìsurface2);border:1px solid var(‚Äìborder);border-radius:12px;padding:12px 14px;display:flex;align-items:center;gap:9px;margin-bottom:8px}
.btn-reativar{background:none;border:1.5px solid var(‚Äìborder);border-radius:7px;padding:4px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;color:var(‚Äìmuted);font-family:inherit;font-weight:600;white-space:nowrap}
.btn-reativar:hover{border-color:var(‚Äìgreen);color:var(‚Äìgreen)}

/* EMPTY */
.empty-state{text-align:center;padding:32px 20px;color:var(‚Äìmuted)}
.empty-state .ei{width:48px;height:48px;background:var(‚Äìsurface2);border-radius:16px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px}
.empty-state .ei svg{width:22px;height:22px;stroke:var(‚Äìmuted2)}
.empty-state p{font-size:13px;line-height:1.7;font-weight:500}

/* TOAST */
.toast{position:fixed;bottom:110px;left:50%;transform:translateX(-50%) translateY(20px);background:var(‚Äìtext);color:var(‚Äìsurface);padding:11px 20px;border-radius:20px;font-size:13px;z-index:9999;opacity:0;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);pointer-events:none;white-space:nowrap;font-weight:600;box-shadow:var(‚Äìshadow-lg);display:flex;align-items:center;gap:7px}
.toast svg{width:14px;height:14px;stroke:currentColor}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.error{background:var(‚Äìred)}
.toast.success{background:#16a34a}

@media(max-width:600px){
.mini-cards{grid-template-columns:1fr 1fr}
.form-row,.form-row.tri{grid-template-columns:1fr}
.tipo-select{grid-template-columns:repeat(2,1fr)}
.parc-fields.show{grid-template-columns:1fr 1fr}
.mf-grid{grid-template-columns:1fr 1fr}
.ob-grid2,.pf-grid2{grid-template-columns:1fr}
.drawer{width:100vw}
}
</style>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div id="loading-overlay"><div class="loading-spinner"></div><div id="loading-msg">Carregando...</div></div>

<div id="auth-screen">
 <div class="auth-wrap">
  <div class="auth-logo">Fina<span>S</span></div>
  <div class="auth-tagline">Controle financeiro inteligente</div>
  <div class="auth-card">
   <div class="auth-tabs">
    <div class="auth-tab auth-tab-active" id="tab-login" onclick="showAuthTab('login')">Entrar</div>
    <div class="auth-tab" id="tab-register" onclick="showAuthTab('register')">Criar conta</div>
   </div>
   <!-- LOGIN -->
   <div id="form-login">
    <button class="btn-google" onclick="loginGoogle()">
     <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
     Continuar com Google
    </button>
    <div class="auth-divider"><span>ou use seu e-mail</span></div>
    <div class="auth-field"><label>E-mail</label><input type="email" id="login-email" placeholder="seu@email.com" onkeydown="if(event.key==='Enter')login()"></div>
    <div class="auth-field"><label>Senha</label><input type="password" id="login-senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeydown="if(event.key==='Enter')login()"></div>
    <button class="btn-auth" onclick="login()">Entrar</button>
    <button class="auth-link" onclick="resetPassword()">Esqueci minha senha</button>
   </div>
   <!-- REGISTER -->
   <div id="form-register" style="display:none">
    <button class="btn-google" onclick="loginGoogle()">
     <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
     Criar conta com Google
    </button>
    <div class="auth-divider"><span>ou use seu e-mail</span></div>
    <div class="auth-field"><label>Nome completo</label><input type="text" id="auth-nome" placeholder="Ex: Ana Lima"></div>
    <div class="auth-field"><label>E-mail</label><input type="email" id="auth-email" placeholder="seu@email.com"></div>
    <div class="auth-field"><label>Senha</label><input type="password" id="auth-senha" placeholder="M√≠nimo 6 caracteres"></div>
    <div class="auth-field"><label>Confirmar senha</label><input type="password" id="auth-confirma" placeholder="Repita a senha" onkeydown="if(event.key==='Enter')register()"></div>
    <button class="btn-auth" onclick="register()">Criar conta gr√°tis</button>
    <div class="auth-benefits">
     <div class="ab-item"><span>üéÅ</span> 14 dias completos gr√°tis</div>
     <div class="ab-item"><span>‚òÅÔ∏è</span> Dados na nuvem ‚Äî acesse de qualquer lugar</div>
     <div class="ab-item"><span>ü§ñ</span> Assistente IA para d√∫vidas financeiras</div>
    </div>
   </div>
  </div>
 </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div id="onboard-screen">
 <div class="ob-wrap">
  <div class="ob-header"><div class="ob-logo">Fina<span>S</span></div><p style="font-size:12px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;margin-top:4px;font-weight:600">Configure seu perfil</p></div>
  <div class="ob-card">
   <div class="ob-step active" id="ob-s1">
    <div class="step-indicator"><div class="si-dot active"></div><div class="si-dot"></div><div class="si-dot"></div><div class="si-dot"></div></div>
    <div class="ob-q">Qual √© o seu perfil?</div><div class="ob-hint">Personaliza seus insights e dicas financeiras.</div>
    <div class="pg"><div class="pc" onclick="selPersona('estagiario')" id="p-estagiario"><div class="pc-icon">üéì</div><div class="pc-name">Estagi√°rio(a)</div><div class="pc-desc">Bolsa, come√ßando agora</div></div><div class="pc" onclick="selPersona('clt')" id="p-clt"><div class="pc-icon">üíº</div><div class="pc-name">CLT</div><div class="pc-desc">Registrado, renda est√°vel</div></div><div class="pc" onclick="selPersona('autonomo')" id="p-autonomo"><div class="pc-icon">‚ö°</div><div class="pc-name">Aut√¥nomo</div><div class="pc-desc">Renda vari√°vel</div></div><div class="pc" onclick="selPersona('semrenda')" id="p-semrenda"><div class="pc-icon">üå±</div><div class="pc-name">Sem renda fixa</div><div class="pc-desc">Bicos ou buscando emprego</div></div></div>
    <button class="btn-ob-next" onclick="obNext(2)">Continuar</button>
   </div>
   <div class="ob-step" id="ob-s2">
    <div class="step-indicator"><div class="si-dot done"></div><div class="si-dot active"></div><div class="si-dot"></div><div class="si-dot"></div></div>
    <div class="ob-q">Sobre voc√™</div><div class="ob-hint">Quanto mais preciso, melhores os insights.</div>
    <div class="ob-grid2"><div class="ob-field"><label>Nome</label><input type="text" id="ob-nome" placeholder="Ex: Ana"></div><div class="ob-field"><label>Idade</label><input type="number" id="ob-idade" placeholder="22" min="14" max="80"></div></div>
    <div class="ob-field"><label>Renda mensal l√≠quida (R$)</label><input type="number" id="ob-renda" placeholder="Ex: 1500" step="0.01"></div>
    <div class="ob-field"><label>Como voc√™ recebe?</label></div>
    <div class="freq-grid"><div class="fq-btn" onclick="selFreq('mensal')" id="fq-mensal"><div class="fq-icon">üìÖ</div><div class="fq-name">Mensal</div><div class="fq-desc">1x por m√™s</div></div><div class="fq-btn" onclick="selFreq('quinzenal')" id="fq-quinzenal"><div class="fq-icon">üóì</div><div class="fq-name">Quinzenal</div><div class="fq-desc">2x por m√™s</div></div><div class="fq-btn" onclick="selFreq('semanal')" id="fq-semanal"><div class="fq-icon">üìÜ</div><div class="fq-name">Semanal</div><div class="fq-desc">toda semana</div></div><div class="fq-btn" onclick="selFreq('variavel')" id="fq-variavel"><div class="fq-icon">üé≤</div><div class="fq-name">Vari√°vel</div><div class="fq-desc">irregular</div></div></div>
    <button class="btn-ob-next" onclick="obNext(3)">Continuar</button>
    <button class="btn-ob-back" onclick="obNext(1)">Voltar</button>
   </div>
   <div class="ob-step" id="ob-s3">
    <div class="step-indicator"><div class="si-dot done"></div><div class="si-dot done"></div><div class="si-dot active"></div><div class="si-dot"></div></div>
    <div class="ob-q">Qual √© o seu objetivo?</div><div class="ob-hint">Define como calculamos seus dados.</div>
    <div class="obj-list"><div class="obj-item" onclick="selObj('sobrar')" id="obj-sobrar"><div class="obj-icon">üí∏</div><div><div class="obj-name">Sobrar dinheiro</div><div class="obj-sub">Quero um valor X livre todo m√™s</div></div></div><div class="obj-item" onclick="selObj('quitar')" id="obj-quitar"><div class="obj-icon">üî¥</div><div><div class="obj-name">Quitar d√≠vidas</div><div class="obj-sub">Prioridade √© zerar o que devo</div></div></div><div class="obj-item" onclick="selObj('poupar')" id="obj-poupar"><div class="obj-icon">üè¶</div><div><div class="obj-name">Come√ßar a poupar</div><div class="obj-sub">Criar reserva de emerg√™ncia</div></div></div><div class="obj-item" onclick="selObj('controlar')" id="obj-controlar"><div class="obj-icon">üìä</div><div><div class="obj-name">Controlar gastos</div><div class="obj-sub">Saber pra onde meu dinheiro vai</div></div></div></div>
    <button class="btn-ob-next" onclick="obNext(4)">Continuar</button>
    <button class="btn-ob-back" onclick="obNext(2)">Voltar</button>
   </div>
   <div class="ob-step" id="ob-s4">
    <div class="step-indicator"><div class="si-dot done"></div><div class="si-dot done"></div><div class="si-dot done"></div><div class="si-dot active"></div></div>
    <div class="ob-q">Defina sua meta</div><div class="ob-hint">Vira um limite ativo com alerta em tempo real.</div>
    <div class="ob-grid2"><div class="ob-field"><label>Limite de gastos/m√™s (R$)</label><input type="number" id="ob-meta-gasto" placeholder="Ex: 1400" step="0.01"></div><div class="ob-field"><label>Meta de economia/m√™s (R$)</label><input type="number" id="ob-meta-economia" placeholder="Ex: 220" step="0.01"></div></div>
    <div class="ob-grid2"><div class="ob-field"><label>Renda extra (opcional)</label><input type="number" id="ob-extra" placeholder="Ex: 200" step="0.01"></div><div class="ob-field"><label>Origem</label><input type="text" id="ob-extra-desc" placeholder="Ex: freelas"></div></div>
    <button class="btn-ob-next" onclick="finishOnboard()">Come√ßar meu controle</button>
    <button class="btn-ob-back" onclick="obNext(3)">Voltar</button>
   </div>
  </div>
 </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DRAWER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer">
 <div class="drawer-header">
  <div class="drawer-title">Menu</div>
  <button class="btn-drawer-close" onclick="closeDrawer()"><svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/></svg></button>
 </div>
 <div class="drawer-body">
  <nav class="drawer-nav">
   <button class="drawer-nav-item active" onclick="showSection('sec-perfil')"><svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7" stroke-linecap="round"/></svg>Meu Perfil</button>
   <button class="drawer-nav-item" onclick="showSection('sec-planos')"><svg viewBox="0 0 24 24" fill="none"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>Planos<span class="dna" id="dna-plano">FREE</span></button>
   <button class="drawer-nav-item" onclick="showSection('sec-arquivo')"><svg viewBox="0 0 24 24" fill="none"><polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/></svg>Arquivo<span class="dna" id="dna-arquivo">0</span></button>
   <button class="drawer-nav-item" onclick="showSection('sec-suporte')"><svg viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>Suporte</button>
   <button class="drawer-nav-item" onclick="showSection('sec-sobre')"><svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Sobre</button>
  </nav>
  <div class="drawer-section active" id="sec-perfil">
   <div class="ds-title">Meu Perfil</div>
   <div class="pf-grid2"><div class="pf-field"><label>Nome</label><input type="text" id="pf-nome"></div><div class="pf-field"><label>Idade</label><input type="number" id="pf-idade"></div></div>
   <div class="pf-grid2"><div class="pf-field"><label>E-mail</label><input type="email" id="pf-email" readonly style="opacity:0.5"></div><div class="pf-field"><label>Telefone</label><input type="tel" id="pf-tel" placeholder="(11) 99999-9999"></div></div>
   <div class="pf-field"><label>Perfil</label><select id="pf-persona"><option value="estagiario">Estagi√°rio(a)</option><option value="clt">CLT</option><option value="autonomo">Aut√¥nomo</option><option value="semrenda">Sem renda fixa</option></select></div>
   <div class="pf-grid2"><div class="pf-field"><label>Renda (R$)</label><input type="number" id="pf-renda" step="0.01"></div><div class="pf-field"><label>Frequ√™ncia</label><select id="pf-freq"><option value="mensal">Mensal</option><option value="quinzenal">Quinzenal</option><option value="semanal">Semanal</option><option value="variavel">Vari√°vel</option></select></div></div>
   <div class="pf-grid2"><div class="pf-field"><label>Renda extra (R$)</label><input type="number" id="pf-extra" step="0.01"></div><div class="pf-field"><label>Origem extra</label><input type="text" id="pf-extra-desc"></div></div>
   <div class="pf-grid2"><div class="pf-field"><label>Limite gastos</label><input type="number" id="pf-meta-gasto" step="0.01"></div><div class="pf-field"><label>Meta economia</label><input type="number" id="pf-meta-eco" step="0.01"></div></div>
   <div class="pf-field"><label>Objetivo</label><select id="pf-objetivo"><option value="sobrar">Sobrar dinheiro</option><option value="quitar">Quitar d√≠vidas</option><option value="poupar">Come√ßar a poupar</option><option value="controlar">Controlar gastos</option></select></div>
   <button class="btn-save-profile" onclick="saveProfile()">Salvar perfil</button>
  </div>
  <div class="drawer-section" id="sec-planos">
   <div class="ds-title">Planos</div>
   <div class="plans-grid">
    <div class="plan-card"><div class="plan-name">Free</div><div class="plan-price">R$ 0<span>/sempre</span></div><div class="plan-desc">14 dias completos. Depois, funcionalidades b√°sicas.</div><div class="plan-features"><div class="pf-item">‚úÖ Lan√ßamentos</div><div class="pf-item">‚úÖ Resumo mensal</div><div class="pf-item">‚úÖ 1 meta ativa</div><div class="pf-item">‚úÖ Chat IA: 10 msgs/m√™s</div><div class="pf-item locked">üîí Gr√°ficos avan√ßados</div><div class="pf-item locked">üîí Chat IA ilimitado</div></div><button class="btn-plan free-btn">Plano atual</button></div>
    <div class="plan-card featured"><div class="plan-badge-tag">MELHOR</div><div class="plan-name" style="color:var(--accent)">Pro</div><div class="plan-price" style="color:var(--accent)">R$ 9,90<span>/m√™s</span></div><div class="plan-desc">Acesso completo. Menos de R$ 0,33/dia.</div><div class="plan-features"><div class="pf-item">‚úÖ Tudo do Free</div><div class="pf-item">‚úÖ Gr√°ficos de evolu√ß√£o</div><div class="pf-item">‚úÖ An√°lise avan√ßada</div><div class="pf-item">‚úÖ Metas ilimitadas</div><div class="pf-item">‚úÖ Chat IA ilimitado</div><div class="pf-item">‚úÖ Bot Telegram integrado</div></div><button class="btn-plan pro-btn" onclick="selectPlan('pro')">Assinar por R$ 9,90/m√™s</button><div class="trial-info-sm">Cancele quando quiser</div></div>
   </div>
  </div>
  <div class="drawer-section" id="sec-arquivo"><div class="ds-title">D√≠vidas arquivadas</div><p style="font-size:12px;color:var(--muted);margin-bottom:14px;line-height:1.7;font-weight:500">D√≠vidas com parcelas encerradas ficam aqui.</p><div id="arquivo-list"></div></div>
  <div class="drawer-section" id="sec-suporte">
   <div class="ds-title">Suporte</div>
   <a class="support-item" href="https://wa.me/5511999999999" target="_blank"><svg viewBox="0 0 24 24" fill="none"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg><div><div class="support-title">WhatsApp</div><div class="support-sub">Resposta em at√© 24h</div></div><svg style="margin-left:auto;width:14px;height:14px" viewBox="0 0 24 24" fill="none"><polyline points="9 18 15 12 9 6"/></svg></a>
   <a class="support-item" href="mailto:suporte@finas.app"><svg viewBox="0 0 24 24" fill="none"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><div><div class="support-title">E-mail</div><div class="support-sub">suporte@finas.app</div></div><svg style="margin-left:auto;width:14px;height:14px" viewBox="0 0 24 24" fill="none"><polyline points="9 18 15 12 9 6"/></svg></a>
   <div style="margin:14px 0 9px;font-size:13px;font-weight:800">Perguntas frequentes</div>
   <div class="faq-item"><div class="faq-q" onclick="toggleFaq(this)">Diferen√ßa entre fixo e vari√°vel? <span>+</span></div><div class="faq-a">Fixo: repete todo m√™s (aluguel, luz). Vari√°vel: acontece esporadicamente (farm√°cia, lazer).</div></div>
   <div class="faq-item"><div class="faq-q" onclick="toggleFaq(this)">Como o chat IA funciona? <span>+</span></div><div class="faq-a">O assistente conhece seus dados e responde perguntas personalizadas. Free: 10 msgs/m√™s. Pro: ilimitado.</div></div>
   <div class="faq-item"><div class="faq-q" onclick="toggleFaq(this)">Meus dados s√£o seguros? <span>+</span></div><div class="faq-a">Sim. Firebase (Google Cloud), criptografados. Cada usu√°rio acessa apenas seus pr√≥prios dados.</div></div>
   <div class="faq-item"><div class="faq-q" onclick="toggleFaq(this)">Como usar o bot Telegram? <span>+</span></div><div class="faq-a">Dispon√≠vel no plano Pro. Voc√™ conecta seu Telegram no perfil e manda mensagens como "Uber 25" ou "resumo" diretamente pelo app de mensagens.</div></div>
  </div>
  <div class="drawer-section" id="sec-sobre">
   <div class="sobre-logo">Fina<span>S</span></div><div class="sobre-version">v8.0 ¬∑ 2026</div>
   <p class="sobre-text">Controle financeiro inteligente para estagi√°rios, CLTs e aut√¥nomos. Sem an√∫ncios. Sem complica√ß√£o.</p>
   <div class="sobre-stats"><div class="ss-item"><div class="ss-val">4</div><div class="ss-lbl">perfis</div></div><div class="ss-item"><div class="ss-val">‚àû</div><div class="ss-lbl">insights</div></div><div class="ss-item"><div class="ss-val">0</div><div class="ss-lbl">an√∫ncios</div></div></div>
   <div class="sobre-links"><button class="sobre-link" onclick="showSection('sec-suporte')">Suporte</button><button class="sobre-link" onclick="showSection('sec-planos')">Planos</button><button class="sobre-link" onclick="logout()">Sair</button></div>
  </div>
 </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODAL EDITAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="modal-overlay" id="modalOverlay" onclick="closeEditModal()"></div>
<div class="modal" id="editModal">
 <div class="modal-handle"></div>
 <div class="modal-header">
  <div class="modal-title">Editar lan√ßamento</div>
  <button class="btn-modal-close" onclick="closeEditModal()"><svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke-linecap="round"/></svg></button>
 </div>
 <div class="modal-body">
  <input type="hidden" id="edit-id">
  <div class="form-row"><div class="fg"><label>Descri√ß√£o</label><input type="text" id="edit-desc" placeholder="Ex: Aluguel, Padaria..."></div><div class="fg"><label>Valor (R$)</label><input type="number" id="edit-valor" placeholder="0,00" step="0.01" min="0"></div></div>
  <div class="form-row tri">
   <div class="fg"><label>Tipo</label><select id="edit-tipo"><option value="gasto">Gasto</option><option value="recebimento">Recebimento</option><option value="divida">D√≠vida</option><option value="investimento">Investimento</option></select></div>
   <div class="fg"><label>Recorr√™ncia</label><select id="edit-recorr"><option value="variavel">Vari√°vel</option><option value="fixo">Fixo</option></select></div>
   <div class="fg"><label>Categoria</label><select id="edit-cat"><option value="moradia">Moradia</option><option value="educacao">Educa√ß√£o</option><option value="transporte">Transporte</option><option value="alimentacao">Alimenta√ß√£o</option><option value="saude">Sa√∫de</option><option value="lazer">Lazer</option><option value="assinaturas">Assinaturas</option><option value="vestuario">Vestu√°rio</option><option value="divida">D√≠vida</option><option value="outros">Outros</option></select></div>
  </div>
  <div class="form-row"><div class="fg"><label>Dia vencimento</label><input type="number" id="edit-dia" placeholder="Ex: 5" min="1" max="31"></div><div class="fg"><label>M√™s/Ano</label><input type="text" id="edit-mes" placeholder="Ex: Mar/2026"></div></div>
  <button class="btn-save" onclick="saveEditItem()" style="margin-top:4px">Salvar altera√ß√µes</button>
 </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div id="app-screen">
 <!-- HEADER -->
 <div class="app-header">
  <div><div class="hl-logo">Fina<span>S</span></div><div class="hl-greeting" id="greeting">‚Äî</div></div>
  <div class="header-right">
   <div class="plan-badge free" id="plan-badge" onclick="openDrawer('sec-planos')">Pro</div>
   <div class="btn-avatar" onclick="openDrawer('sec-perfil')" id="pb-avatar">P</div>
  </div>
 </div>
 <div class="trial-banner" id="trial-banner" style="display:none"><div class="trial-banner-text" id="trial-banner-text">‚Äî</div><button class="btn-trial-upgrade" onclick="openDrawer('sec-planos')">Ver Pro</button></div>

 <!-- HOME -->

 <div class="panel active" id="panel-home">
  <div class="panel-inner">
   <div class="month-selector">
    <button class="month-nav" onclick="changeMes(-1)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg></button>
    <div class="month-info"><div class="month-name" id="mes-label">‚Äî</div><div class="month-tag atual" id="mes-tag"></div></div>
    <button class="month-nav" onclick="changeMes(1)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg></button>
   </div>
   <div class="summary-card">
    <div class="sc-bar"></div>
    <div class="sc-label">Saldo livre este m√™s</div>
    <div class="sc-value" id="tc-livre">‚Äî</div>
    <div class="sc-sub" id="tc-livre-sub">ap√≥s todos os gastos</div>
   </div>
   <div class="mini-cards">
    <div class="mini-card"><div class="mc-icon green"><svg viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg></div><div class="mc-label">Renda Total</div><div class="mc-value green" id="tc-renda">‚Äî</div><div class="mc-sub" id="tc-renda-sub">‚Äî</div></div>
    <div class="mini-card"><div class="mc-icon red"><svg viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div class="mc-label">Comprometido</div><div class="mc-value red" id="tc-gasto">‚Äî</div><div class="mc-sub" id="tc-gasto-sub">da renda</div></div>
    <div class="mini-card"><div class="mc-icon accent"><svg viewBox="0 0 24 24" fill="none" stroke="#7c6ff7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg></div><div class="mc-label">Fixos</div><div class="mc-value accent" id="tc-fixos">‚Äî</div><div class="mc-sub">recorrentes</div></div>
    <div class="mini-card"><div class="mc-icon orange"><svg viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div><div class="mc-label">Vari√°veis</div><div class="mc-value orange" id="tc-variaveis">‚Äî</div><div class="mc-sub">espor√°dicos</div></div>
   </div>
   <div class="progress-card">
    <div class="pc-top"><span class="pc-title">Sa√∫de financeira</span><span class="pc-pct" id="hb-pct">0%</span></div>
    <div class="progress-track"><div class="progress-fill" id="bar-fill" style="width:0%"></div></div>
    <div class="pc-legend"><div class="pcl-item"><div class="pcl-dot" style="background:var(--green)"></div>At√© 70%</div><div class="pcl-item"><div class="pcl-dot" style="background:var(--orange)"></div>70‚Äì90%</div><div class="pcl-item"><div class="pcl-dot" style="background:var(--red)"></div>+90%</div></div>
   </div>
   <div class="section-header">
    <div class="section-title">Metas do m√™s</div>
    <button class="btn-sm" onclick="toggleMetaForm()"><svg viewBox="0 0 24 24" fill="none"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Nova</button>
   </div>
   <div id="metas-list"></div>
   <div class="meta-form-inline" id="meta-form">
    <div class="mf-grid">
     <div class="fg"><label>Nome</label><input type="text" id="mf-nome" placeholder="Ex: Lazer..."></div>
     <div class="fg"><label>Limite (R$)</label><input type="number" id="mf-limite" placeholder="300" step="0.01"></div>
     <div class="fg"><label>Categoria</label><select id="mf-cat"><option value="">Todas</option><option value="moradia">Moradia</option><option value="alimentacao">Alimenta√ß√£o</option><option value="transporte">Transporte</option><option value="lazer">Lazer</option><option value="saude">Sa√∫de</option><option value="assinaturas">Assinaturas</option></select></div>
     <div class="fg"><label>&nbsp;</label><button class="btn-meta-save" onclick="addMeta()">Salvar</button></div>
    </div>
   </div>
  </div>
 </div>

 <!-- LAN√áAMENTOS -->

 <div class="panel" id="panel-lancamentos">
  <div class="panel-inner">
   <div class="form-card">
    <div class="form-card-title">Novo lan√ßamento <span class="form-card-tag">Enter = salvar</span></div>
    <div class="tipo-select">
     <div class="tb" onclick="selTipo('gasto')" id="t-gasto"><div class="ti"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg></div><div class="tn">Gasto</div></div>
     <div class="tb" onclick="selTipo('recebimento')" id="t-recebimento"><div class="ti"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg></div><div class="tn">Recebimento</div></div>
     <div class="tb" onclick="selTipo('divida')" id="t-divida"><div class="ti"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg></div><div class="tn">D√≠vida</div></div>
     <div class="tb" onclick="selTipo('investimento')" id="t-investimento"><div class="ti"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div><div class="tn">Investimento</div></div>
    </div>
    <div class="recorr-select">
     <div class="rb" onclick="selRecorr('fixo')" id="r-fixo"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>Fixo</div>
     <div class="rb sel" onclick="selRecorr('variavel')" id="r-variavel"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Vari√°vel</div>
    </div>
    <div class="form-row"><div class="fg"><label>Descri√ß√£o</label><input type="text" id="f-desc" placeholder="Ex: Aluguel, Padaria..."></div><div class="fg"><label>Valor (R$)</label><input type="number" id="f-valor" placeholder="0,00" step="0.01" min="0"></div></div>
    <div class="form-row tri"><div class="fg"><label>Categoria</label><select id="f-cat"><option value="moradia">Moradia</option><option value="educacao">Educa√ß√£o</option><option value="transporte">Transporte</option><option value="alimentacao">Alimenta√ß√£o</option><option value="saude">Sa√∫de</option><option value="lazer">Lazer</option><option value="assinaturas">Assinaturas</option><option value="vestuario">Vestu√°rio</option><option value="divida">D√≠vida</option><option value="outros">Outros</option></select></div><div class="fg"><label>Dia vencimento</label><input type="number" id="f-dia" placeholder="Ex: 5" min="1" max="31"></div><div class="fg"><label>M√™s/Ano</label><input type="text" id="f-mes" placeholder="Ex: Mar/2026"></div></div>
    <label class="parc-toggle"><input type="checkbox" id="f-parc" onchange="toggleParc()"><span class="parc-toggle-lbl"><strong>Parcelado?</strong> ‚Äî informe as parcelas</span></label>
    <div class="parc-fields" id="parc-fields"><div class="fg"><label>N¬∫ parcelas</label><input type="number" id="f-np" placeholder="12" min="1"></div><div class="fg"><label>Parcela atual</label><input type="number" id="f-pa" placeholder="1" min="1"></div><div class="fg"><label>M√™s in√≠cio</label><input type="text" id="f-mi" placeholder="Mar/2026"></div></div>
    <button class="btn-save" onclick="addItem()">Salvar lan√ßamento</button>
   </div>
   <div class="filter-row">
    <div class="fb active" onclick="setFilter(this,'todos')">Todos</div>
    <div class="fb" onclick="setFilter(this,'gasto')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>Gastos</div>
    <div class="fb" onclick="setFilter(this,'recebimento')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>Entradas</div>
    <div class="fb" onclick="setFilter(this,'divida')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>D√≠vidas</div>
    <div class="fb" onclick="setFilter(this,'investimento')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Invest.</div>
    <div class="fb" onclick="setFilter(this,'arquivado')">Arquivados</div>
   </div>
   <div class="swipe-hint" style="color:var(--muted2);font-size:11px;text-align:center;padding:8px;display:flex;align-items:center;justify-content:center;gap:5px;font-weight:500" id="swipe-hint" style="display:none"><svg viewBox="0 0 24 24" fill="none"><polyline points="15 18 9 12 15 6"/></svg>Arraste um item para editar ou excluir</div>
   <div class="gastos-lista" id="gastos-lista"></div>
  </div>
 </div>

 <!-- AN√ÅLISE -->

 <div class="panel" id="panel-analise">
  <div class="panel-inner">
   <div class="analise-card"><div class="ac-title"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7" stroke-linecap="round"/></svg>Seu perfil</div><div class="perfil-box" id="perfil-box">‚Äî</div><div id="insight-list"></div></div>
   <div class="analise-card" style="position:relative"><div id="analise-lock" class="lock-overlay"><div class="lock-icon"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div><div class="lock-text">An√°lise avan√ßada no <strong>Pro</strong></div><button class="btn-unlock" onclick="openDrawer('sec-planos')">Ver planos</button></div><div class="ac-title"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Sugest√µes de Investimento</div><div id="invest-sugestoes"></div></div>
   <div class="chart-section" style="position:relative"><div id="grafico-lock" class="lock-overlay"><div class="lock-icon"><svg viewBox="0 0 24 24" fill="none"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div><div class="lock-text">Gr√°ficos no <strong>Pro</strong></div><button class="btn-unlock" onclick="openDrawer('sec-planos')">Ver planos</button></div><div class="chart-header"><div class="chart-title"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Evolu√ß√£o mensal</div><div class="chart-legend"><div class="cl-item"><div class="cl-dot" style="background:var(--green)"></div>Renda</div><div class="cl-item"><div class="cl-dot" style="background:var(--accent)"></div>Fixos</div><div class="cl-item"><div class="cl-dot" style="background:var(--red)"></div>Vari√°veis</div></div></div><div class="chart-wrap"><canvas id="monthlyChart"></canvas></div><div class="chart-months-summary" id="months-summary"></div></div>
   <div class="chart-section"><div class="chart-header"><div class="chart-title"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>Por categoria</div></div><div class="chart-wrap" style="height:180px"><canvas id="catChart"></canvas></div></div>
  </div>
 </div>

 <!-- CHAT IA -->

 <div class="panel" id="panel-chat">
  <div class="panel-inner">
   <div class="chat-wrap">
    <div class="chat-header">
     <div class="chat-header-left">
      <div class="chat-ai-avatar"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/><circle cx="9" cy="14" r="1"/><circle cx="15" cy="14" r="1"/></svg></div>
      <div><div class="chat-ai-name">Assistente FinaS</div><div class="chat-ai-sub">Especialista financeiro ¬∑ IA</div></div>
     </div>
     <div id="chat-counter">10 msgs</div>
    </div>
    <div class="chat-list" id="chat-list"></div>
    <div class="chat-input-wrap">
     <textarea id="chat-input" placeholder="Pergunte sobre investimentos, como economizar..." rows="1" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendChatMessage()}"></textarea>
     <button id="chat-send" onclick="sendChatMessage()"><svg viewBox="0 0 24 24" fill="none"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
    </div>
   </div>
   <p style="font-size:11px;color:var(--muted);text-align:center;padding:10px;line-height:1.5;font-weight:500">N√£o √© consultoria financeira. Para decis√µes importantes, consulte um profissional.</p>
  </div>
 </div>

</div><!-- /app-screen -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOTTOM NAV (s√≥ aparece no app) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<div class="bottom-nav-wrap" id="bottom-nav-wrap" style="display:none">
 <div class="bottom-nav">
  <div class="bn-item active" onclick="switchTab('home')" id="bn-home">
   <div class="bn-icon-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
   <div class="bn-label">Home</div>
  </div>
  <div class="bn-item" onclick="switchTab('lancamentos')" id="bn-lancamentos">
   <div class="bn-icon-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></div>
   <div class="bn-label">Lan√ßar</div>
  </div>
  <div class="bn-item" onclick="switchTab('analise')" id="bn-analise">
   <div class="bn-icon-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg></div>
   <div class="bn-label">An√°lise</div>
  </div>
  <div class="bn-item" onclick="switchTab('chat')" id="bn-chat">
   <div class="bn-icon-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"/></svg></div>
   <div class="bn-label">IA</div>
  </div>
 </div>
</div>

<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê OVERRIDES & NEW FEATURES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<script>

// ‚¨áÔ∏è SUBSTITUA COM SUAS CREDENCIAIS DO FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyAMvPzOjgoO-OHgkV270NN1BFXWimHxG38",
  authDomain: "finas-app-430a8.firebaseapp.com",
  projectId: "finas-app-430a8",
  storageBucket: "finas-app-430a8.firebasestorage.app",
  messagingSenderId: "37160132569",
  appId: "1:37160132569:web:1413256559764bc424c3c8",
  measurementId: "G-YX7VCJ5HRX"
};

// ‚¨áÔ∏è COLE SUA CHAVE DA API ANTHROPIC AQUI (para o chat com IA)
// Obtenha em: https://console.anthropic.com
// ATEN√á√ÉO: em produ√ß√£o, use um backend para proteger esta chave!
const ANTHROPIC_KEY = "COLE_SUA_ANTHROPIC_API_KEY_AQUI";
// ‚¨ÜÔ∏è FIM DAS CREDENCIAIS

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const googleProvider = new firebase.auth.GoogleAuthProvider();

// Sess√£o persistente ‚Äî usu√°rio fica logado at√© clicar em Sair
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

// ============================================================
// CONSTANTES
// ============================================================
const MESES = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
const MESES_ABREV = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
const PERSONA = {
  estagiario:{icon:'üéì',label:'Estagi√°rio(a)',poupar:0.10},
  clt:{icon:'üíº',label:'CLT',poupar:0.20},
  autonomo:{icon:'‚ö°',label:'Aut√¥nomo',poupar:0.25},
  semrenda:{icon:'üå±',label:'Sem renda fixa',poupar:0}
};
const TIPO_CFG = {
  gasto:{icon:'üí∏',color:'#e84c2b',bg:'#fff5f3',bb:'#f0b8a8',bc:'#c73520'},
  recebimento:{icon:'üí∞',color:'#28a35c',bg:'#f4fbf7',bb:'#a8d5b8',bc:'#1e7a43'},
  divida:{icon:'üî¥',color:'#e8952b',bg:'#fff8f0',bb:'#f0d5a8',bc:'#b06010'},
  investimento:{icon:'üìà',color:'#2b6de8',bg:'#f0f4ff',bb:'#a8bde8',bc:'#1a4fb0'}
};
const CATEGORIAS = ['moradia','educacao','transporte','alimentacao','saude','lazer','assinaturas','vestuario','divida','investimento','outros'];
const CAT_ICONS = {moradia:'üè†',educacao:'üéì',transporte:'üöå',alimentacao:'üçî',saude:'üíä',lazer:'üéÆ',assinaturas:'üì±',vestuario:'üëï',divida:'üí≥',investimento:'üìà',outros:'üì¶'};
const FREE_CHAT_LIMIT = 10; // mensagens/m√™s no plano free

// ============================================================
// ESTADO
// ============================================================
let currentUser = null, userProfile = null, userItems = [], userMetas = [],
    userArquivo = [], userPlan = {type:'free',trialStart:null};
let curMes = null, tipoSel = 'gasto', filterSel = 'todos', recorrSel = 'variavel';
let _chartMonthly = null, _chartCat = null;
let chatHistory = [];
let chatMsgCount = 0;

// ============================================================
// UTILS
// ============================================================
const fmtBRL = v => 'R$ '+Math.abs(v).toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.');
const mesKey = (m,y) => `${y}-${String(m+1).padStart(2,'0')}`;
const curKey = () => mesKey(curMes.m,curMes.y);

function toast(msg,type='default'){
  const t=document.getElementById('toast');
  t.textContent=msg; t.className='toast show '+type;
  setTimeout(()=>t.classList.remove('show'),2800);
}
function showLoading(msg='Carregando...'){document.getElementById('loading-overlay').style.display='flex';document.getElementById('loading-msg').textContent=msg;}
function hideLoading(){document.getElementById('loading-overlay').style.display='none';}

// ============================================================
// AUTH
// ============================================================
auth.onAuthStateChanged(async user => {
  if(user){
    currentUser=user; showLoading('Carregando seus dados...');
    await loadUserData(); hideLoading(); showApp();
  } else { currentUser=null; showAuth(); }
});

async function loginGoogle(){
  try{
    showLoading('Entrando com Google...');
    const result = await auth.signInWithPopup(googleProvider);
    const user = result.user;
    // Cria perfil se for primeiro acesso
    const userDoc = await db.collection('users').doc(user.uid).get();
    if(!userDoc.exists){
      await db.collection('users').doc(user.uid).set({
        nome: user.displayName||'Usu√°rio',
        email: user.email,
        criadoEm: new Date().toISOString(),
        plan:{type:'free',trialStart:new Date().toISOString()}
      });
    }
  } catch(e){
    hideLoading();
    toast(e.code==='auth/popup-closed-by-user'?'Login cancelado.':'Erro ao entrar com Google!','error');
  }
}

async function register(){
  const nome=document.getElementById('auth-nome').value.trim();
  const email=document.getElementById('auth-email').value.trim();
  const senha=document.getElementById('auth-senha').value;
  const confirma=document.getElementById('auth-confirma').value;
  if(!nome||!email||!senha){toast('Preencha todos os campos!','error');return;}
  if(senha!==confirma){toast('Senhas n√£o coincidem!','error');return;}
  if(senha.length<6){toast('Senha: m√≠nimo 6 caracteres!','error');return;}
  try{
    showLoading('Criando conta...');
    const cred=await auth.createUserWithEmailAndPassword(email,senha);
    await cred.user.updateProfile({displayName:nome});
    await db.collection('users').doc(cred.user.uid).set({
      nome,email,criadoEm:new Date().toISOString(),
      plan:{type:'free',trialStart:new Date().toISOString()}
    });
    toast('Conta criada! Bem-vindo! üéâ');
  } catch(e){
    hideLoading();
    const msgs={'auth/email-already-in-use':'E-mail j√° cadastrado!','auth/invalid-email':'E-mail inv√°lido!','auth/weak-password':'Senha muito fraca!'};
    toast(msgs[e.code]||'Erro ao criar conta!','error');
  }
}

async function login(){
  const email=document.getElementById('login-email').value.trim();
  const senha=document.getElementById('login-senha').value;
  if(!email||!senha){toast('Preencha e-mail e senha!','error');return;}
  try{
    showLoading('Entrando...');
    await auth.signInWithEmailAndPassword(email,senha);
  } catch(e){
    hideLoading();
    const msgs={'auth/user-not-found':'Usu√°rio n√£o encontrado!','auth/wrong-password':'Senha incorreta!','auth/invalid-credential':'E-mail ou senha incorretos!'};
    toast(msgs[e.code]||'Erro ao entrar!','error');
  }
}

async async function logout(){
  if(!confirm('Sair do FinaS?'))return;
  if(window._itemsListener){window._itemsListener();window._itemsListener=null;}
  await auth.signOut();
  userItems=[];userMetas=[];userArquivo=[];userProfile=null;chatHistory=[];
}

async function resetPassword(){
  const email=document.getElementById('login-email').value.trim();
  if(!email){toast('Digite seu e-mail primeiro!','error');return;}
  try{await auth.sendPasswordResetEmail(email);toast('E-mail de recupera√ß√£o enviado! üìß');}
  catch(e){toast('Erro ao enviar e-mail!','error');}
}

// ============================================================
// FIRESTORE
// ============================================================
async function loadUserData(){
  const uid=currentUser.uid;
  try{
    const userDoc=await db.collection('users').doc(uid).get();
    if(userDoc.exists){
      userProfile=userDoc.data();
      userPlan=userDoc.data().plan||{type:'free',trialStart:new Date().toISOString()};
    }
    const [itemsSnap,metasSnap,arquivoSnap]=await Promise.all([
      db.collection('users').doc(uid).collection('items').get(),
      db.collection('users').doc(uid).collection('metas').get(),
      db.collection('users').doc(uid).collection('arquivo').get()
    ]);
    userItems=itemsSnap.docs.map(d=>({id:d.id,...d.data()}));
    userMetas=metasSnap.docs.map(d=>({id:d.id,...d.data()}));
    userArquivo=arquivoSnap.docs.map(d=>({id:d.id,...d.data()}));
    const nowK=mesKey(new Date().getMonth(),new Date().getFullYear());
    chatMsgCount=userProfile?.chatCount?.[nowK]||0;

    // ‚îÄ‚îÄ Listener em tempo real: sincroniza itens sem precisar recarregar p√°gina ‚îÄ‚îÄ
    if(window._itemsListener) window._itemsListener(); // cancela listener anterior
    let _firstSnapshot = true;
    window._itemsListener = db.collection('users').doc(uid).collection('items')
      .onSnapshot(snap=>{
        userItems = snap.docs.map(d=>({id:d.id,...d.data()}));
        // No primeiro disparo (ao carregar), j√° temos os dados ‚Äî s√≥ renderiza se app vis√≠vel
        if(_firstSnapshot){ _firstSnapshot=false; return; }
        // Disparos subsequentes = mudan√ßa em tempo real
        if(userProfile && typeof renderAll==='function') renderAll();
      }, err=>console.warn('Sync error:',err));

  } catch(e){console.error(e);if(typeof toast==='function')toast('Erro ao carregar dados!','error');}
}

async function fsAddItem(item){
  const ref=await db.collection('users').doc(currentUser.uid).collection('items').add(item);
  item.id=ref.id; return item;
}
async function fsDeleteItem(id){await db.collection('users').doc(currentUser.uid).collection('items').doc(id).delete();}
async function fsAddMeta(meta){const ref=await db.collection('users').doc(currentUser.uid).collection('metas').add(meta);meta.id=ref.id;return meta;}
async function fsDeleteMeta(id){await db.collection('users').doc(currentUser.uid).collection('metas').doc(id).delete();}
async function fsArchive(item){
  await db.collection('users').doc(currentUser.uid).collection('items').doc(item.id).delete();
  const arch={...item,archivedAt:new Date().toISOString(),motivo:'Parcelas encerradas'};
  const ref=await db.collection('users').doc(currentUser.uid).collection('arquivo').add(arch);
  arch.id=ref.id; return arch;
}
async function fsReactivate(item){
  await db.collection('users').doc(currentUser.uid).collection('arquivo').doc(item.id).delete();
  const {archivedAt,motivo,...clean}=item;
  const ref=await db.collection('users').doc(currentUser.uid).collection('items').add(clean);
  clean.id=ref.id; return clean;
}
async function fsSaveProfile(data){await db.collection('users').doc(currentUser.uid).update(data);Object.assign(userProfile,data);}
async function fsUpdatePlan(type){
  const pd={type,updatedAt:new Date().toISOString()};
  if(type==='pro')pd.proStart=new Date().toISOString();
  await db.collection('users').doc(currentUser.uid).update({plan:pd});
  userPlan=pd;
}
async function fsIncrementChat(){
  const nowK=mesKey(new Date().getMonth(),new Date().getFullYear());
  chatMsgCount++;
  const upd={};upd[`chatCount.${nowK}`]=chatMsgCount;
  await db.collection('users').doc(currentUser.uid).update(upd);
}

// ============================================================
// AUTO-ARCHIVE
// ============================================================
async function autoArchive(){
  const toArchive=userItems.filter(i=>(i.tipo==='divida'||i.tipo==='gasto')&&i.parcelado&&i.nParcelas&&i.parcelaAtual>=i.nParcelas);
  for(const item of toArchive){
    const arch=await fsArchive(item);
    userArquivo.push(arch);
    userItems=userItems.filter(i=>i.id!==item.id);
  }
  if(toArchive.length===1)toast(`üì¶ "${toArchive[0].desc}" arquivada.`);
  else if(toArchive.length>1)toast(`üì¶ ${toArchive.length} d√≠vidas arquivadas.`);
}

// ============================================================
// PLAN
// ============================================================
function isPro(){return userPlan?.type==='pro';}
function trialDaysLeft(){
  if(!userPlan?.trialStart)return 14;
  const diff=Math.floor((Date.now()-new Date(userPlan.trialStart).getTime())/(864e5));
  return Math.max(0,14-diff);
}
function hasFullAccess(){return isPro()||trialDaysLeft()>0;}
function chatRemaining(){return isPro()?999:Math.max(0,FREE_CHAT_LIMIT-chatMsgCount);}

// ============================================================
// SCREENS
// ============================================================
function showAuth(){
  hideLoading();
  document.getElementById('auth-screen').style.display='flex';
  document.getElementById('app-screen').style.display='none';
  document.getElementById('onboard-screen').style.display='none';
}
function showApp(){
  document.getElementById('auth-screen').style.display='none';
  document.getElementById('onboard-screen').style.display='none';
  if(!userProfile?.persona){document.getElementById('onboard-screen').style.display='flex';return;}
  initMesNow();
  document.getElementById('app-screen').style.display='block';
  initApp();
  autoArchive().then(()=>renderAll());
}
function initMesNow(){if(!curMes){const n=new Date();curMes={m:n.getMonth(),y:n.getFullYear()};}}

// ============================================================
// AUTH UI
// ============================================================
function showAuthTab(tab){
  ['login','register'].forEach(t=>{
    document.getElementById('tab-'+t).classList.toggle('auth-tab-active',t===tab);
    document.getElementById('form-'+t).style.display=t===tab?'block':'none';
  });
}

// ============================================================
// ONBOARDING
// ============================================================
let _obStep=1,_obPersona=null,_obFreq=null,_obObj=null;
function selPersona(p){_obPersona=p;document.querySelectorAll('.pc').forEach(c=>c.classList.remove('sel'));document.getElementById('p-'+p).classList.add('sel');}
function selFreq(f){_obFreq=f;document.querySelectorAll('.fq-btn').forEach(b=>b.classList.remove('sel'));document.getElementById('fq-'+f).classList.add('sel');}
function selObj(o){_obObj=o;document.querySelectorAll('.obj-item').forEach(b=>b.classList.remove('sel'));document.getElementById('obj-'+o).classList.add('sel');}
function obNext(n){
  if(n===2&&!_obPersona){toast('Selecione seu perfil!','error');return;}
  if(n===3){if(!parseFloat(document.getElementById('ob-renda').value)){toast('Informe sua renda!','error');return;}if(!_obFreq){toast('Selecione a frequ√™ncia!','error');return;}}
  if(n===4&&!_obObj){toast('Selecione seu objetivo!','error');return;}
  document.getElementById('ob-s'+_obStep).classList.remove('active');
  _obStep=n;
  document.getElementById('ob-s'+n).classList.add('active');
  document.querySelectorAll('#onboard-screen .si-dot').forEach((d,i)=>{
    if(i+1<n)d.className='si-dot done';
    else if(i+1===n)d.className='si-dot active';
    else d.className='si-dot';
  });
}
async function finishOnboard(){
  const nome=document.getElementById('ob-nome').value.trim()||currentUser.displayName||'Voc√™';
  const profileData={nome,idade:parseInt(document.getElementById('ob-idade').value)||null,
    persona:_obPersona||'clt',renda:parseFloat(document.getElementById('ob-renda').value)||0,
    freq:_obFreq||'mensal',objetivo:_obObj||'controlar',
    extra:parseFloat(document.getElementById('ob-extra').value)||0,
    extraDesc:document.getElementById('ob-extra-desc').value.trim(),
    metaGasto:parseFloat(document.getElementById('ob-meta-gasto').value)||0,
    metaEco:parseFloat(document.getElementById('ob-meta-economia').value)||0,
    email:currentUser.email};
  showLoading('Salvando perfil...');
  await fsSaveProfile(profileData);
  hideLoading(); showApp();
}

// ============================================================
// APP INIT
// ============================================================
function initApp(){
  if(!userProfile)return;
  const pm=PERSONA[userProfile.persona]||PERSONA.clt;
  document.getElementById('pb-name').textContent=userProfile.nome||currentUser.email;
  document.getElementById('pb-type').textContent=pm.label;
  const h=new Date().getHours();
  document.getElementById('greeting').textContent=`${h<12?'Bom dia':h<18?'Boa tarde':'Boa noite'}, ${(userProfile.nome||'').split(' ')[0]||'voc√™'}! ‚ú®`;
  selTipo('gasto'); selRecorr('variavel'); renderPlanBadge();
}

function renderPlanBadge(){
  const badge=document.getElementById('plan-badge'),days=trialDaysLeft(),banner=document.getElementById('trial-banner');
  const gLock=document.getElementById('grafico-lock'),aLock=document.getElementById('analise-lock');
  if(isPro()){
    badge.className='plan-badge pro';badge.innerHTML='‚≠ê PRO';
    document.getElementById('dna-plano').textContent='PRO';
    banner.style.display='none';
    if(gLock)gLock.style.display='none';if(aLock)aLock.style.display='none';
  } else {
    badge.className='plan-badge free';badge.innerHTML=`‚≠ê FREE${days>0?' ¬∑ '+days+'d':''}`;
    document.getElementById('dna-plano').textContent='FREE';
    if(days>0){banner.style.display='flex';document.getElementById('trial-banner-text').innerHTML=`üéÅ Trial ativo: <strong>${days} dias restantes</strong>.`;if(gLock)gLock.style.display='none';if(aLock)aLock.style.display='none';}
    else{banner.style.display='flex';document.getElementById('trial-banner-text').innerHTML=`‚è∞ Trial expirado. <strong>Assine o Pro</strong> para acesso completo.`;if(gLock)gLock.style.display='flex';if(aLock)aLock.style.display='flex';}
  }
  updateChatUI();
}

// ============================================================
// DRAWER
// ============================================================
function openDrawer(section){
  document.getElementById('drawer').classList.add('open');
  document.getElementById('drawerOverlay').classList.add('open');
  if(section)showSection(section);
  populateProfile();renderArquivo();
}
function closeDrawer(){document.getElementById('drawer').classList.remove('open');document.getElementById('drawerOverlay').classList.remove('open');}
function showSection(id){
  document.querySelectorAll('.drawer-section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.drawer-nav-item').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const idx={'sec-perfil':0,'sec-planos':1,'sec-arquivo':2,'sec-suporte':3,'sec-sobre':4};
  const items=document.querySelectorAll('.drawer-nav-item');
  if(idx[id]!==undefined)items[idx[id]].classList.add('active');
}
function toggleFaq(el){
  const a=el.nextElementSibling,isOpen=a.classList.contains('open');
  document.querySelectorAll('.faq-a').forEach(x=>x.classList.remove('open'));
  document.querySelectorAll('.faq-q span').forEach(x=>x.textContent='+');
  if(!isOpen){a.classList.add('open');el.querySelector('span').textContent='‚àí';}
}
function populateProfile(){
  if(!userProfile)return;
  const p=userProfile;
  const fields={'pf-nome':p.nome,'pf-idade':p.idade,'pf-email':p.email||currentUser?.email,'pf-tel':p.tel,'pf-renda':p.renda,'pf-extra':p.extra,'pf-extra-desc':p.extraDesc,'pf-meta-gasto':p.metaGasto,'pf-meta-eco':p.metaEco};
  for(const[id,val]of Object.entries(fields)){const el=document.getElementById(id);if(el)el.value=val||'';}
  document.getElementById('pf-persona').value=p.persona||'clt';
  document.getElementById('pf-freq').value=p.freq||'mensal';
  document.getElementById('pf-objetivo').value=p.objetivo||'controlar';
}
async function saveProfile(){
  const data={nome:document.getElementById('pf-nome').value.trim()||'Voc√™',
    idade:parseInt(document.getElementById('pf-idade').value)||null,
    tel:document.getElementById('pf-tel').value.trim(),
    persona:document.getElementById('pf-persona').value,
    renda:parseFloat(document.getElementById('pf-renda').value)||0,
    freq:document.getElementById('pf-freq').value,
    extra:parseFloat(document.getElementById('pf-extra').value)||0,
    extraDesc:document.getElementById('pf-extra-desc').value.trim(),
    metaGasto:parseFloat(document.getElementById('pf-meta-gasto').value)||0,
    metaEco:parseFloat(document.getElementById('pf-meta-eco').value)||0,
    objetivo:document.getElementById('pf-objetivo').value,
    email:currentUser?.email};
  showLoading('Salvando...');
  await fsSaveProfile(data);
  hideLoading();initApp();renderAll();toast('Perfil salvo! ‚úÖ');closeDrawer();
}
async function selectPlan(p){
  if(p==='pro'){
    // üîó Em produ√ß√£o: window.open('SEU_LINK_STRIPE','_blank');
    showLoading('Ativando Pro...');
    await fsUpdatePlan('pro');
    hideLoading();renderPlanBadge();toast('üéâ Bem-vindo ao Pro!');closeDrawer();
  }
}
function renderArquivo(){
  const list=document.getElementById('arquivo-list');
  document.getElementById('dna-arquivo').textContent=userArquivo.length;
  if(!userArquivo.length){list.innerHTML=`<div class="empty-state" style="padding:20px"><p>Nenhuma d√≠vida arquivada.</p></div>`;return;}
  list.innerHTML=userArquivo.map(i=>`<div class="arquivo-item"><div style="font-size:18px">${TIPO_CFG[i.tipo]?.icon||'üì¶'}</div><div style="flex:1;min-width:0"><div style="font-size:12px;font-weight:600">${i.desc}</div><div style="font-size:10px;color:var(--muted)">${fmtBRL(i.valor)}/m√™s ¬∑ ${i.nParcelas||'?'} parcelas ¬∑ ${i.archivedAt?new Date(i.archivedAt).toLocaleDateString('pt-BR'):'-'}</div></div><button class="btn-reativar" onclick="reactivate('${i.id}')">Reativar</button></div>`).join('');
}
async function reactivate(id){
  const item=userArquivo.find(i=>i.id===id);if(!item)return;
  showLoading('Reativando...');
  const clean=await fsReactivate(item);
  userArquivo=userArquivo.filter(i=>i.id!==id);
  userItems.push(clean);
  hideLoading();renderAll();renderArquivo();toast('D√≠vida reativada! ‚úÖ');
}

// ============================================================
// RENDER PRINCIPAL
// ============================================================
function renderAll(){
  initMesNow();
  if(!curMes) return;
  const now=new Date(),isCur=curMes.m===now.getMonth()&&curMes.y===now.getFullYear();
  const mesLbl=document.getElementById('mes-label');
  if(mesLbl)mesLbl.textContent=`${MESES[curMes.m]} / ${curMes.y}`;
  const mt=document.getElementById('mes-tag');
  if(mt){mt.textContent=isCur?'atual':'';mt.className='mes-tag'+(isCur?' atual':'');}
  renderTopCards();renderMetas();renderLista();
  // Pain√©is opcionais ‚Äî s√≥ renderiza se existir e estiver ativo
  const tryPanel=(id,fn)=>{const el=document.getElementById(id);if(el&&el.classList.contains('active')&&typeof fn==='function')fn();};
  tryPanel('panel-grafico',renderGrafico);
  tryPanel('panel-analise',renderAnalise);
  tryPanel('panel-quinzena',typeof renderQuinzena!=='undefined'?renderQuinzena:null);
  tryPanel('panel-categorias',typeof renderCategorias!=='undefined'?renderCategorias:null);
}
function changeMes(d){let{m,y}=curMes;m+=d;if(m<0){m=11;y--;}if(m>11){m=0;y++;}curMes={m,y};renderAll();}
function itemsDoMes(key){
  return userItems.filter(i=>{
    if(i.mesAno===key) return true;
    // Item fixo sem mesAno espec√≠fico = recorrente, aparece em todos os meses
    if(!i.mesAno && i.recorrencia==='fixo') return true;
    // Item vari√°vel sem mesAno = sem data definida, exibe no m√™s atual
    if(!i.mesAno && i.recorrencia!=='fixo'){
      const n=new Date(), nowKey=mesKey(n.getMonth(),n.getFullYear());
      return key===nowKey;
    }
    return false;
  });
}
function getRendaTotal(){if(!userProfile)return 0;const recv=userItems.filter(i=>i.tipo==='recebimento'&&(i.mesAno===curKey()||!i.mesAno)).reduce((s,i)=>s+i.valor,0);return(userProfile.renda||0)+(userProfile.extra||0)+recv;}
function getGastoTotal(){return itemsDoMes(curKey()).filter(i=>i.tipo==='gasto'||i.tipo==='divida').reduce((s,i)=>s+i.valor,0);}

function renderTopCards(){
  if(!userProfile)return;
  const renda=getRendaTotal(),gasto=getGastoTotal(),livre=renda-gasto,pct=renda>0?(gasto/renda)*100:0,p=userProfile;

  // Renda
  document.getElementById('tc-renda').textContent=fmtBRL(renda);
  document.getElementById('tc-renda-sub').textContent=p.freq==='quinzenal'?`‚âà ${fmtBRL(renda/2)}/quinzena`:p.freq||'mensal';

  // Comprometido
  const elGasto=document.getElementById('tc-gasto');
  elGasto.textContent=fmtBRL(gasto);
  elGasto.className='mc-value '+(pct>90?'red':pct>70?'orange':'red');
  document.getElementById('tc-gasto-sub').textContent=pct.toFixed(0)+'% da renda';

  // Saldo livre (summary card)
  const elLivre=document.getElementById('tc-livre');
  elLivre.textContent=fmtBRL(livre);
  elLivre.className='sc-value '+(livre<0?'red':livre<renda*0.1?'':'green');
  document.getElementById('tc-livre-sub').textContent=livre<0?'aten√ß√£o: no vermelho!':p.metaEco>0?`meta: guardar ${fmtBRL(p.metaEco)}`:'ap√≥s todos os gastos';

  // Barra de sa√∫de
  const fill=document.getElementById('bar-fill');
  if(fill){
    fill.style.width=Math.min(pct,100)+'%';
    fill.style.background=pct>90?'var(--red)':pct>70?'var(--orange)':'var(--green)';
  }
  const hbPct=document.getElementById('hb-pct');
  if(hbPct)hbPct.textContent=pct.toFixed(0)+'%';

  // Fixos vs vari√°veis
  const fixos=itemsDoMes(curKey()).filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia==='fixo').reduce((s,i)=>s+i.valor,0);
  const variaveis=itemsDoMes(curKey()).filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia!=='fixo').reduce((s,i)=>s+i.valor,0);
  const elFixos=document.getElementById('tc-fixos');
  const elVar=document.getElementById('tc-variaveis');
  if(elFixos){elFixos.textContent=fmtBRL(fixos);elFixos.className='mc-value accent';}
  if(elVar){elVar.textContent=fmtBRL(variaveis);elVar.className='mc-value orange';}

  // tc-meta ‚Äî elementos opcionais (podem n√£o existir no novo HTML)
  const elMeta=document.getElementById('tc-meta');
  if(elMeta){
    const mg=p.metaGasto||0;
    if(mg>0){const diff=mg-gasto;elMeta.textContent=fmtBRL(diff>0?diff:0);const elMetaSub=document.getElementById('tc-meta-sub');if(elMetaSub)elMetaSub.textContent=diff<0?'Meta estourada!':'restam';}
    else{elMeta.textContent='‚Äî';}
  }
}

// ============================================================
// METAS
// ============================================================
function toggleMetaForm(){const f=document.getElementById('meta-form');f.className=f.classList.contains('show')?'meta-form-inline':'meta-form-inline show';}
async function addMeta(){
  const nome=document.getElementById('mf-nome').value.trim(),limite=parseFloat(document.getElementById('mf-limite').value),cat=document.getElementById('mf-cat').value;
  if(!nome||!limite||limite<=0){toast('Preencha nome e limite!','error');return;}
  if(!isPro()&&!trialDaysLeft()&&userMetas.length>=1){toast('Limite de 1 meta no Free. Assine o Pro!','error');openDrawer('sec-planos');return;}
  showLoading('Salvando...');
  const meta=await fsAddMeta({nome,limite,cat,criadoEm:new Date().toISOString()});
  userMetas.push(meta);hideLoading();
  document.getElementById('mf-nome').value='';document.getElementById('mf-limite').value='';
  renderMetas();toggleMetaForm();toast('Meta adicionada! üéØ');
}
async function removeMeta(id){await fsDeleteMeta(id);userMetas=userMetas.filter(m=>m.id!==id);renderMetas();}
function renderMetas(){
  const list=document.getElementById('metas-list');
  if(!userMetas.length){list.innerHTML=`<div style="font-size:11px;color:var(--muted);padding:4px 0">Nenhuma meta. Adicione um limite por categoria.</div>`;return;}
  const key=curKey();
  list.innerHTML=userMetas.map(meta=>{
    const gasto=userItems.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&(i.mesAno===key||!i.mesAno)&&(meta.cat===''||i.cat===meta.cat)).reduce((s,i)=>s+i.valor,0);
    const pct=meta.limite>0?(gasto/meta.limite)*100:0,resto=meta.limite-gasto;
    let st,sc;if(pct>=100){st='Estourada!';sc='fail';}else if(pct>=80){st='Quase';sc='warn';}else{st='OK';sc='ok';}
    const bc=pct>=100?'var(--accent)':pct>=80?'var(--warn)':'var(--accent3)';
    return `<div class="meta-item"><div class="mi-top"><div class="mi-name">üéØ ${meta.nome}${meta.cat?` <span style="font-size:9px;color:var(--muted)">(${CAT_ICONS[meta.cat]||''}${meta.cat})</span>`:''}</div><div style="display:flex;align-items:center;gap:5px"><span class="mi-status ${sc}">${st}</span><button class="mi-del" onclick="removeMeta('${meta.id}')">‚úï</button></div></div><div class="mi-vals"><span>Gasto: <strong>${fmtBRL(gasto)}</strong></span><span>Limite: <strong>${fmtBRL(meta.limite)}</strong></span><span style="color:${resto<0?'var(--accent)':'var(--muted)'}">${resto<0?'Excesso: '+fmtBRL(Math.abs(resto)):'Resta: '+fmtBRL(resto)}</span></div><div class="mi-bar-track"><div class="mi-bar-fill" style="width:${Math.min(pct,100)}%;background:${bc}"></div></div></div>`;
  }).join('');
}

// ============================================================
// FORM LAN√áAMENTOS
// ============================================================
function selTipo(t){tipoSel=t;document.querySelectorAll('.tb').forEach(b=>b.className='tb');document.getElementById('t-'+t).classList.add('tb','sel-'+t);}
function selRecorr(r){recorrSel=r;document.querySelectorAll('.rb').forEach(b=>b.classList.remove('sel'));document.getElementById('r-'+r).classList.add('sel');}
function toggleParc(){const c=document.getElementById('f-parc').checked;document.getElementById('parc-fields').className=c?'parc-fields show':'parc-fields';}
function setFilter(el,f){filterSel=f;document.querySelectorAll('.fb').forEach(b=>b.classList.remove('active'));el.classList.add('active');renderLista();}

function parseMesAno(str){
  const mMap={jan:0,fev:1,mar:2,abr:3,mai:4,jun:5,jul:6,ago:7,set:8,out:9,nov:10,dez:11};
  const parts=str.toLowerCase().split('/');
  if(parts.length===2){const mi=mMap[parts[0].substring(0,3)];const yi=parseInt(parts[1]);if(mi!==undefined&&yi>2000)return mesKey(mi,yi);}
  return curKey();
}

async function addItem(){
  const desc=document.getElementById('f-desc').value.trim(),valor=parseFloat(document.getElementById('f-valor').value);
  if(!desc||!valor||valor<=0){toast('Preencha descri√ß√£o e valor!','error');return;}
  const mesInput=document.getElementById('f-mes').value.trim();
  const parc=document.getElementById('f-parc').checked;
  const item={tipo:tipoSel,desc,valor,cat:document.getElementById('f-cat').value,
    dia:parseInt(document.getElementById('f-dia').value)||null,
    mesAno:mesInput?parseMesAno(mesInput):curKey(),
    recorrencia:recorrSel,
    parcelado:parc,
    nParcelas:parc?(parseInt(document.getElementById('f-np').value)||null):null,
    parcelaAtual:parc?(parseInt(document.getElementById('f-pa').value)||1):null,
    mesInicio:parc?document.getElementById('f-mi').value.trim():null,
    criadoEm:new Date().toISOString()};
  showLoading('Salvando...');
  const saved=await fsAddItem(item);
  userItems.push(saved);hideLoading();
  ['f-desc','f-valor','f-dia','f-mes','f-np','f-pa','f-mi'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-parc').checked=false;toggleParc();
  await autoArchive();toast('Salvo! ‚úÖ');renderAll();
}

async function removeItem(id){
  showLoading('Removendo...');
  await fsDeleteItem(id);userItems=userItems.filter(i=>i.id!==id);
  hideLoading();renderAll();
}

// ============================================================
// LISTA (com agrupamento por recorr√™ncia e categoria)
// ============================================================
function renderLista(){
  const lista=document.getElementById('gastos-lista');
  if(filterSel==='arquivado'){
    if(!userArquivo.length){lista.innerHTML=`<div class="empty-state"><div class="ei">üì¶</div><p>Nenhuma d√≠vida arquivada.</p></div>`;return;}
    lista.innerHTML=userArquivo.map(item=>{
      const tc=TIPO_CFG[item.tipo]||TIPO_CFG.gasto;
      return `<div class="gi" style="opacity:0.7"><div class="gi-icon" style="background:${tc.bg}">${tc.icon}</div><div class="gi-body"><div class="gi-title">${item.desc} <span class="expired-tag">arquivada</span></div><div class="gi-meta"><span>${item.nParcelas||'?'} parcelas</span></div></div><div class="gi-right"><div class="gi-val" style="color:${tc.color}">-${fmtBRL(item.valor)}</div></div></div>`;
    }).join('');return;
  }

  let items=itemsDoMes(curKey());
  if(filterSel!=='todos')items=items.filter(i=>i.tipo===filterSel);
  if(!items.length){lista.innerHTML=`<div class="empty-state"><div class="ei">üì≠</div><p>Nenhum lan√ßamento em ${MESES[curMes.m]} / ${curMes.y}.</p></div>`;return;}

  // separa fixos e vari√°veis (s√≥ para gastos/d√≠vidas)
  const fixos=items.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia==='fixo');
  const variaveis=items.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia!=='fixo');
  const outros=items.filter(i=>i.tipo==='recebimento'||i.tipo==='investimento');

  let html='';

  if(fixos.length>0){
    const totalFixo=fixos.reduce((s,i)=>s+i.valor,0);
    html+=`<div class="lista-group-header"><span class="lgh-label">Gastos Fixos</span><span class="lgh-total">-${fmtBRL(totalFixo)}</span></div>`;
    fixos.sort((a,b)=>(a.dia||99)-(b.dia||99)).forEach(item=>{html+=renderGiItem(item);});
  }
  if(variaveis.length>0){
    const totalVar=variaveis.reduce((s,i)=>s+i.valor,0);
    html+=`<div class="lista-group-header"><span class="lgh-label">Gastos Vari√°veis</span><span class="lgh-total">-${fmtBRL(totalVar)}</span></div>`;
    variaveis.sort((a,b)=>(a.dia||99)-(b.dia||99)).forEach(item=>{html+=renderGiItem(item);});
  }
  if(outros.length>0){
    outros.sort((a,b)=>(a.dia||99)-(b.dia||99)).forEach(item=>{html+=renderGiItem(item);});
  }

  lista.innerHTML=html;
}

function renderGiItem(item){
  const tc=TIPO_CFG[item.tipo]||TIPO_CFG.gasto;
  const pctP=item.parcelado&&item.nParcelas?((item.parcelaAtual-1)/item.nParcelas)*100:0;
  const catIcon=CAT_ICONS[item.cat]||'üì¶';
  const recTag=item.recorrencia==='fixo'?`<span style="font-size:9px;background:rgba(124,111,247,0.1);border:1px solid rgba(124,111,247,0.3);color:#7c6ff7;padding:2px 7px;border-radius:20px;font-weight:700;">fixo</span>`:'';
  return `<div class="gi"><div class="gi-icon" style="background:${tc.bg}">${tc.icon}</div><div class="gi-body"><div class="gi-title">${item.desc}</div><div class="gi-meta"><span class="gi-badge" style="background:${tc.bg};border-color:${tc.bb};color:${tc.bc}">${item.tipo}</span><span>${catIcon} ${item.cat||''}</span>${item.dia?`<span>dia ${item.dia}</span>`:''}${item.parcelado&&item.nParcelas?`<span style="color:var(--warn)">${item.parcelaAtual}/${item.nParcelas} parcelas</span>`:''}${recTag}</div>${item.parcelado&&item.nParcelas?`<div class="pp-bar"><div class="pp-fill" style="width:${pctP}%"></div></div>`:''}</div><div class="gi-right"><div class="gi-val" style="color:${tc.color}">${item.tipo==='recebimento'?'+':'-'}${fmtBRL(item.valor)}</div>${item.parcelado&&item.nParcelas?`<div class="gi-parc">${fmtBRL(item.valor*item.nParcelas)} total</div>`:''}</div><button class="gi-del" onclick="removeItem('${item.id}')">‚úï</button></div>`;
}

// ============================================================
// CATEGORIAS (nova aba)
// ============================================================
function renderCategorias(){
  const key=curKey();
  const gastos=itemsDoMes(key).filter(i=>i.tipo==='gasto'||i.tipo==='divida');
  const catMap={};
  gastos.forEach(i=>{
    const c=i.cat||'outros';
    if(!catMap[c])catMap[c]={fixo:0,variavel:0,items:[]};
    if(i.recorrencia==='fixo')catMap[c].fixo+=i.valor;else catMap[c].variavel+=i.valor;
    catMap[c].items.push(i);
  });

  const renda=getRendaTotal();
  const cats=Object.keys(catMap).sort((a,b)=>(catMap[b].fixo+catMap[b].variavel)-(catMap[a].fixo+catMap[a].variavel));

  if(!cats.length){document.getElementById('cat-lista').innerHTML=`<div class="empty-state"><div class="ei">üìä</div><p>Nenhum gasto registrado este m√™s.</p></div>`;return;}

  document.getElementById('cat-lista').innerHTML=cats.map(cat=>{
    const d=catMap[cat];
    const total=d.fixo+d.variavel;
    const pct=renda>0?(total/renda)*100:0;
    const icon=CAT_ICONS[cat]||'üì¶';
    const itemsHtml=d.items.sort((a,b)=>(b.valor-a.valor)).map(i=>`
      <div class="cat-sub-item">
        <span class="csi-tag ${i.recorrencia==='fixo'?'fixo':'variavel'}">${i.recorrencia==='fixo'?'üìå':'üîÄ'}</span>
        <span class="csi-name">${i.desc}</span>
        ${i.dia?`<span class="csi-dia">dia ${i.dia}</span>`:''}
        <span class="csi-val">-${fmtBRL(i.valor)}</span>
        <button class="gi-del" onclick="removeItem('${i.id}')">‚úï</button>
      </div>`).join('');
    return `<div class="cat-card">
      <div class="cat-card-header" onclick="toggleCatCard(this)">
        <div class="cch-left">
          <span class="cch-icon">${icon}</span>
          <div>
            <div class="cch-name">${cat}</div>
            <div class="cch-sub">${d.items.length} lan√ßamento${d.items.length>1?'s':''} ¬∑ ${pct.toFixed(0)}% da renda</div>
          </div>
        </div>
        <div class="cch-right">
          <div class="cch-total">-${fmtBRL(total)}</div>
          ${d.fixo>0?`<div class="cch-sub2">üìå ${fmtBRL(d.fixo)}</div>`:''}
          ${d.variavel>0?`<div class="cch-sub2">üîÄ ${fmtBRL(d.variavel)}</div>`:''}
          <span class="cch-arrow">‚Ä∫</span>
        </div>
      </div>
      <div class="cat-bar-track"><div class="cat-bar-fill" style="width:${Math.min(pct*2,100)}%;background:${pct>30?'var(--accent)':pct>15?'var(--warn)':'var(--accent3)'}"></div></div>
      <div class="cat-items" style="display:none">${itemsHtml}</div>
    </div>`;
  }).join('');
}

function toggleCatCard(header){
  const items=header.parentElement.querySelector('.cat-items');
  const arrow=header.querySelector('.cch-arrow');
  const open=items.style.display!=='none';
  items.style.display=open?'none':'block';
  arrow.style.transform=open?'':'rotate(90deg)';
}

// ============================================================
// GR√ÅFICO
// ============================================================
function renderGrafico(){
  if(!userProfile)return;
  const renda=(userProfile.renda||0)+(userProfile.extra||0);
  const keysSet=new Set(userItems.filter(i=>i.mesAno).map(i=>i.mesAno));
  const now=new Date();
  for(let i=5;i>=0;i--){const d=new Date(now.getFullYear(),now.getMonth()-i,1);keysSet.add(mesKey(d.getMonth(),d.getFullYear()));}
  const keys=[...keysSet].sort();
  const labels=keys.map(k=>{const[y,m]=k.split('-');return MESES_ABREV[parseInt(m)-1]+'/'+y.substring(2);});
  const gastos=keys.map(k=>userItems.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&(i.mesAno===k||!i.mesAno)).reduce((s,i)=>s+i.valor,0));
  const fixosArr=keys.map(k=>userItems.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia==='fixo'&&(i.mesAno===k||!i.mesAno)).reduce((s,i)=>s+i.valor,0));
  const saldos=keys.map((k,i)=>renda-gastos[i]);
  if(_chartMonthly)_chartMonthly.destroy();
  const ctx=document.getElementById('monthlyChart').getContext('2d');
  _chartMonthly=new Chart(ctx,{type:'bar',data:{labels,datasets:[
    {label:'Renda',data:keys.map(()=>renda),backgroundColor:'rgba(40,163,92,0.1)',borderColor:'#28a35c',borderWidth:2,type:'line',fill:true,tension:0.4,pointBackgroundColor:'#28a35c',pointRadius:4},
    {label:'Fixos',data:fixosArr,backgroundColor:'rgba(43,109,232,0.5)',borderColor:'#2b6de8',borderWidth:1,borderRadius:4,stack:'gastos'},
    {label:'Vari√°veis',data:keys.map((k,i)=>gastos[i]-fixosArr[i]),backgroundColor:'rgba(232,76,43,0.5)',borderColor:'#e84c2b',borderWidth:1,borderRadius:4,stack:'gastos'},
    {label:'Saldo',data:saldos,backgroundColor:'rgba(0,0,0,0)',borderColor:'#e8952b',borderWidth:2,type:'line',tension:0.4,pointBackgroundColor:'#e8952b',pointRadius:5}
  ]},options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>`${c.dataset.label}: ${fmtBRL(c.parsed.y)}`}}},scales:{y:{stacked:false,ticks:{callback:v=>'R$'+v.toLocaleString('pt-BR')},grid:{color:'rgba(0,0,0,0.04)'}},x:{grid:{display:false}}}}});
  document.getElementById('months-summary').innerHTML=keys.map((k,i)=>{const s=saldos[i];return`<div class="cms-item"><div class="cms-month">${labels[i]}</div><div class="cms-val ${s>=0?'pos':'neg'}">${s>=0?'+':'-'}${fmtBRL(s)}</div></div>`;}).join('');
  const catItems=itemsDoMes(curKey()).filter(i=>i.tipo==='gasto'||i.tipo==='divida');
  const catMap={};catItems.forEach(i=>{catMap[i.cat]=(catMap[i.cat]||0)+i.valor;});
  const catLabels=Object.keys(catMap),catVals=catLabels.map(c=>catMap[c]);
  const COLORS=['#e84c2b','#2b6de8','#28a35c','#e8952b','#9b59b6','#1abc9c','#f39c12','#3498db'];
  if(_chartCat)_chartCat.destroy();
  if(catLabels.length>0){const ctx2=document.getElementById('catChart').getContext('2d');_chartCat=new Chart(ctx2,{type:'doughnut',data:{labels:catLabels.map(l=>`${CAT_ICONS[l]||'üì¶'} ${l}`),datasets:[{data:catVals,backgroundColor:COLORS.slice(0,catLabels.length),borderWidth:2,borderColor:'#fff',hoverOffset:6}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{font:{size:11},padding:10}},tooltip:{callbacks:{label:c=>`${c.label}: ${fmtBRL(c.parsed)}`}}},cutout:'65%'}});}
}

// ============================================================
// AN√ÅLISE + INVESTIMENTOS
// ============================================================
function renderAnalise(){
  if(!userProfile)return;
  const p=userProfile,pm=PERSONA[p.persona]||PERSONA.clt;
  const renda=getRendaTotal(),gasto=getGastoTotal(),pct=renda>0?(gasto/renda)*100:0,livre=renda-gasto;
  const fixos=itemsDoMes(curKey()).filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia==='fixo').reduce((s,i)=>s+i.valor,0);
  const variaveis=gasto-fixos;
  document.getElementById('perfil-box').innerHTML=`<strong style="color:var(--text);font-family:'Bricolage Grotesque',sans-serif">${pm.icon} ${p.nome}${p.idade?', '+p.idade+' anos':''} ‚Äî ${pm.label}</strong><br>Renda: <strong>${fmtBRL(p.renda)}</strong>${p.extra>0?` + ${fmtBRL(p.extra)} extra`:''} ¬∑ Freq: ${p.freq||'mensal'}.<br>Objetivo: <em>${{sobrar:'sobrar dinheiro',quitar:'quitar d√≠vidas',poupar:'poupar',controlar:'controlar gastos'}[p.objetivo]||p.objetivo}</em>.`;

  // INSIGHTS
  const ins=[];
  if(renda===0)ins.push({t:'dica',i:'üí°',title:'Configure sua renda',desc:'Edite seu perfil para inserir sua renda e ter an√°lises precisas.'});
  else{
    if(pct>90)ins.push({t:'crit',i:'üö®',title:'Situa√ß√£o cr√≠tica: '+pct.toFixed(0)+'% comprometido',desc:'Praticamente zero de margem. Identifique ao menos um gasto para cortar agora.'});
    else if(pct>70)ins.push({t:'warn',i:'‚ö†Ô∏è',title:'Aten√ß√£o: '+pct.toFixed(0)+'% comprometido',desc:'Acima do recomendado. Tente reduzir gastos vari√°veis como lazer e alimenta√ß√£o fora.'});
    else ins.push({t:'ok',i:'‚úÖ',title:'Sa√∫de financeira boa! ('+pct.toFixed(0)+'%)',desc:'Dentro do limite saud√°vel. Continue assim!'});
    if(fixos>0)ins.push({t:'dica',i:'üìå',title:`Gastos fixos: ${fmtBRL(fixos)}/m√™s`,desc:`${(fixos/renda*100).toFixed(0)}% da sua renda √© comprometida com custos fixos (aluguel, contas, assinaturas). O ideal √© manter abaixo de 50%.`});
    if(variaveis>0)ins.push({t:'dica',i:'üîÄ',title:`Gastos vari√°veis: ${fmtBRL(variaveis)}/m√™s`,desc:`Esses s√£o os gastos mais f√°ceis de reduzir. Revise os itens de lazer, alimenta√ß√£o e vestu√°rio.`});
    if(userArquivo.length>0)ins.push({t:'ok',i:'üì¶',title:`${userArquivo.length} d√≠vida(s) quitada(s)!`,desc:'Parab√©ns! Voc√™ j√° encerrou compromissos financeiros. Continue assim.'});
    if(p.persona==='estagiario')ins.push({t:'dica',i:'üéì',title:'Dica para estagi√°rios',desc:'Crie o h√°bito de guardar agora. Quando for efetivado, a diferen√ßa de renda vira patrim√¥nio.'});
    if(p.persona==='autonomo')ins.push({t:'warn',i:'‚ö°',title:'Aut√¥nomo precisa de reserva',desc:'Guarde 20‚Äì25% de cada pagamento para cobrir meses sem renda.'});
  }
  document.getElementById('insight-list').innerHTML=ins.map(i=>`<div class="insight ${i.t}"><div class="in-icon">${i.i}</div><div><div class="in-title">${i.title}</div><div class="in-desc">${i.desc}</div></div></div>`).join('');

  // SUGEST√ïES DE INVESTIMENTO
  renderInvestSugestoes(renda,livre,p);
}

function renderInvestSugestoes(renda,livre,p){
  const box=document.getElementById('invest-sugestoes');
  if(!box)return;
  const pm=PERSONA[p.persona]||PERSONA.clt;
  const sugs=[];

  if(livre<=0){sugs.push({icon:'‚ö†Ô∏è',titulo:'Equil√≠brio primeiro',desc:'Antes de investir, o foco deve ser equilibrar as contas. Zere o saldo negativo reduzindo gastos vari√°veis.',cor:'warn'});
  } else {
    const poupaMes=renda*pm.poupar;
    if(livre>=poupaMes){
      sugs.push({icon:'üè¶',titulo:'Reserva de Emerg√™ncia',desc:`Com ${fmtBRL(poupaMes)}/m√™s voc√™ forma uma reserva de 6 meses em ${(renda*6/poupaMes).toFixed(0)} meses. Use o <strong>Tesouro Selic</strong> ou uma <strong>CDB com liquidez di√°ria</strong> ‚Äî rendimento de ~100% do CDI com resgate f√°cil.`,cor:'ok'});
    }
    if(p.persona==='estagiario'||p.persona==='semrenda'){
      sugs.push({icon:'üí∞',titulo:'Comece com pouco: R$ 30/m√™s',desc:'Mesmo com renda baixa, investir R$ 30/m√™s em <strong>Tesouro Direto</strong> j√° cria o h√°bito. O Tesouro Selic aceita a partir de R$ 30 e tem liquidez imediata.',cor:'dica'});
    }
    if(p.persona==='clt'||p.persona==='autonomo'){
      if(livre>renda*0.2)sugs.push({icon:'üìä',titulo:'Diversifique seus investimentos',desc:`Voc√™ tem ${fmtBRL(livre)} de saldo livre. Uma sugest√£o: <strong>50%</strong> em renda fixa (CDB/Tesouro), <strong>30%</strong> em fundos de √≠ndice (ETFs como BOVA11), <strong>20%</strong> para objetivos espec√≠ficos.`,cor:'dica'});
      sugs.push({icon:'üì±',titulo:'Previd√™ncia Privada (PGBL/VGBL)',desc:'CLTs podem deduzir at√© 12% da renda bruta em PGBL no imposto de renda. Autonomous devem verificar VGBL como alternativa sem dedu√ß√£o mas com diferimento fiscal.',cor:'dica'});
    }
    if(p.objetivo==='quitar')sugs.push({icon:'üî¥',titulo:'Quitar primeiro, investir depois',desc:'D√≠vidas com juros acima de 10% ao ano (cart√£o, cheque especial) custam mais do que qualquer investimento rende. Priorize quitar antes de investir.',cor:'warn'});
  }

  box.innerHTML=sugs.map(s=>`<div class="insight ${s.cor}"><div class="in-icon">${s.icon}</div><div><div class="in-title">${s.titulo}</div><div class="in-desc">${s.desc}</div></div></div>`).join('');
}

// ============================================================
// QUINZENA
// ============================================================
function renderQuinzena(){
  const key=curKey();
  const q1=userItems.filter(i=>i.dia&&i.dia<=15&&(i.tipo==='gasto'||i.tipo==='divida')&&(i.mesAno===key||!i.mesAno));
  const q2=userItems.filter(i=>i.dia&&i.dia>15&&(i.tipo==='gasto'||i.tipo==='divida')&&(i.mesAno===key||!i.mesAno));
  const mk=items=>items.length===0?`<div style="font-size:11px;color:var(--muted)">Nenhum gasto</div>`:items.map(i=>`<div class="qcard-item"><span class="qcard-item-name">${CAT_ICONS[i.cat]||'üì¶'} ${i.desc}</span><span class="qcard-item-val">-${fmtBRL(i.valor)}</span></div>`).join('');
  document.getElementById('q1-items').innerHTML=mk(q1);
  document.getElementById('q2-items').innerHTML=mk(q2);
  document.getElementById('q1-total').textContent='-'+fmtBRL(q1.reduce((s,i)=>s+i.valor,0));
  document.getElementById('q2-total').textContent='-'+fmtBRL(q2.reduce((s,i)=>s+i.valor,0));
  const parcs=userItems.filter(i=>i.parcelado&&i.nParcelas);
  const pc=document.getElementById('parc-calendar');
  if(!parcs.length){pc.innerHTML=`<div class="empty-state" style="padding:14px"><p>Nenhuma parcela em andamento.</p></div>`;return;}
  pc.innerHTML=parcs.map(i=>{const rest=i.nParcelas-i.parcelaAtual+1;const pct=((i.parcelaAtual-1)/i.nParcelas)*100;return`<div class="parc-card"><div class="parc-card-top"><span class="parc-card-name">${i.desc}</span><span class="parc-card-val">${fmtBRL(i.valor)}/m√™s</span></div><div class="parc-card-meta">Parcela ${i.parcelaAtual} de ${i.nParcelas} ‚Äî faltam ${rest} meses ¬∑ ${fmtBRL(i.valor*rest)} restante</div><div class="bar-track" style="height:5px"><div class="bar-fill" style="width:${pct}%;background:var(--warn)"></div></div></div>`;}).join('');
}

// ============================================================
// CHAT COM IA
// ============================================================
function updateChatUI(){
  const remaining=chatRemaining();
  const counter=document.getElementById('chat-counter');
  if(counter){
    if(isPro()){counter.textContent='Mensagens ilimitadas ‚≠ê';counter.style.color='var(--accent2)';}
    else{counter.textContent=`${remaining} mensagens restantes este m√™s`;counter.style.color=remaining<=2?'var(--accent)':'var(--muted)';}
  }
  const input=document.getElementById('chat-input');
  const btn=document.getElementById('chat-send');
  if(input&&btn){
    const blocked=remaining<=0&&!isPro();
    input.disabled=blocked;btn.disabled=blocked;
    if(blocked){input.placeholder='Limite atingido. Assine o Pro para continuar.';input.style.opacity='0.5';}
  }
}

async function sendChatMessage(){
  if(!currentUser)return;
  const input=document.getElementById('chat-input');
  const msg=input.value.trim();
  if(!msg)return;

  if(!isPro()&&chatMsgCount>=FREE_CHAT_LIMIT){
    toast(`Limite de ${FREE_CHAT_LIMIT} mensagens/m√™s no plano Free. Assine o Pro!`,'error');
    openDrawer('sec-planos');return;
  }

  input.value='';
  appendChatMsg('user',msg);
  const thinking=appendChatMsg('ai','...',true);

  // Contexto financeiro do usu√°rio para a IA
  const renda=getRendaTotal(),gasto=getGastoTotal(),livre=renda-gasto,pct=renda>0?(gasto/renda)*100:0;
  const p=userProfile||{};
  const pm=PERSONA[p.persona]||PERSONA.clt;
  const context=`Voc√™ √© o assistente financeiro do FinaS, um app de controle financeiro brasileiro.
Seja direto, emp√°tico e use linguagem simples. Use R$ para valores. Responda em portugu√™s do Brasil.
Dados financeiros do usu√°rio (${p.nome||'usu√°rio'}):
- Perfil: ${pm.label}
- Renda: ${fmtBRL(renda)}/m√™s
- Gastos totais: ${fmtBRL(gasto)}/m√™s (${pct.toFixed(0)}% da renda)
- Saldo livre: ${fmtBRL(livre)}/m√™s
- Objetivo: ${p.objetivo||'controlar gastos'}
- D√≠vidas ativas: ${userItems.filter(i=>i.tipo==='divida').length}
- Investimentos lan√ßados: ${userItems.filter(i=>i.tipo==='investimento').length}
- Gastos fixos: ${fmtBRL(userItems.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia==='fixo').reduce((s,i)=>s+i.valor,0))}
- Gastos vari√°veis: ${fmtBRL(userItems.filter(i=>(i.tipo==='gasto'||i.tipo==='divida')&&i.recorrencia!=='fixo').reduce((s,i)=>s+i.valor,0))}
Responda de forma concisa (m√°x 3 par√°grafos). Para perguntas sobre investimentos, sempre mencione que n√£o √© consultoria financeira.`;

  chatHistory.push({role:'user',content:msg});

  try{
    const response=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:600,
        system:context,
        messages:chatHistory.slice(-10) // √∫ltimas 10 mensagens para contexto
      })
    });
    const data=await response.json();
    const reply=data.content?.[0]?.text||'N√£o consegui processar sua pergunta. Tente novamente.';
    thinking.remove();
    appendChatMsg('ai',reply);
    chatHistory.push({role:'assistant',content:reply});
    await fsIncrementChat();
    updateChatUI();
  } catch(e){
    thinking.remove();
    appendChatMsg('ai','Erro ao conectar com a IA. Verifique sua chave da API Anthropic.');
    console.error(e);
  }
}

function appendChatMsg(role,text,isLoading=false){
  const list=document.getElementById('chat-list');
  const div=document.createElement('div');
  div.className='chat-msg '+(role==='user'?'chat-user':'chat-ai');
  if(isLoading)div.innerHTML=`<div class="chat-bubble loading"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
  else div.innerHTML=`<div class="chat-bubble">${text.replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')}</div>`;
  list.appendChild(div);
  list.scrollTop=list.scrollHeight;
  return div;
}

function initChat(){
  if(document.getElementById('chat-list').children.length===0){
    const renda=getRendaTotal(),gasto=getGastoTotal(),livre=renda-gasto;
    let greet=`Ol√°, ${(userProfile?.nome||'').split(' ')[0]||'voc√™'}! üëã Sou o assistente financeiro do FinaS.\n\n`;
    if(renda>0){greet+=`Vi que voc√™ tem **${fmtBRL(livre)}** de saldo livre este m√™s. `+
      (livre>0?`√ìtimo! Posso sugerir onde investir esse valor.`:`Que tal revisarmos seus gastos para melhorar isso?`);}
    else greet+='Configure sua renda no perfil para eu te dar insights personalizados.';
    greet+='\n\nO que voc√™ gostaria de saber?';
    appendChatMsg('ai',greet);
  }
  updateChatUI();
}

// ============================================================
// TABS
// ============================================================
function switchTab(t){
  document.querySelectorAll('.tab').forEach((el,i)=>{const ts=['lancamentos','categorias','grafico','analise','quinzena','chat'];el.classList.toggle('active',ts[i]===t);});
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.getElementById('panel-'+t).classList.add('active');
  if(t==='grafico')renderGrafico();
  if(t==='analise')renderAnalise();
  if(t==='quinzena')renderQuinzena();
  if(t==='categorias')renderCategorias();
  if(t==='chat')initChat();
}

// KEYBOARD
document.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){
    if(document.getElementById('panel-lancamentos')?.classList.contains('active')&&document.getElementById('app-screen')?.style.display!=='none')addItem();
    if(document.getElementById('panel-chat')?.classList.contains('active'))sendChatMessage();
  }
});

// EXPO GLOBAL
window.loginGoogle=loginGoogle;window.register=register;window.login=login;window.logout=logout;window.resetPassword=resetPassword;
window.showAuthTab=showAuthTab;window.obNext=obNext;window.selPersona=selPersona;window.selFreq=selFreq;window.selObj=selObj;window.finishOnboard=finishOnboard;
window.openDrawer=openDrawer;window.closeDrawer=closeDrawer;window.showSection=showSection;window.toggleFaq=toggleFaq;
window.saveProfile=saveProfile;window.selectPlan=selectPlan;window.reactivate=reactivate;window.renderArquivo=renderArquivo;
window.toggleMetaForm=toggleMetaForm;window.addMeta=addMeta;window.removeMeta=removeMeta;
window.selTipo=selTipo;window.selRecorr=selRecorr;window.toggleParc=toggleParc;window.setFilter=setFilter;window.addItem=addItem;window.removeItem=removeItem;
window.changeMes=changeMes;window.switchTab=switchTab;window.toggleCatCard=toggleCatCard;
window.sendChatMessage=sendChatMessage;

// ‚ïê‚ïê V8 EXTRAS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showBottomNav(show){
  const el=document.getElementById('bottom-nav-wrap');
  if(el) el.style.display=show?'block':'none';
}

// Mostrar nav s√≥ quando app estiver vis√≠vel (aguarda DOM)
document.addEventListener('DOMContentLoaded',()=>{
  const appEl=document.getElementById('app-screen');
  if(appEl){
    const _navObs=new MutationObserver(()=>{
      showBottomNav(appEl.style.display==='block');
    });
    _navObs.observe(appEl,{attributes:true,attributeFilter:['style']});
  }
});

// Override switchTab para novo HTML
window.switchTab=function(t){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.bn-item').forEach(b=>b.classList.remove('active'));
  const map={home:'panel-home',lancamentos:'panel-lancamentos',analise:'panel-analise',chat:'panel-chat'};
  const p=document.getElementById(map[t]);if(p)p.classList.add('active');
  const b=document.getElementById('bn-'+t);if(b)b.classList.add('active');
  if(t==='analise'){if(typeof renderGrafico==='function')renderGrafico();if(typeof renderAnalise==='function')renderAnalise();}
  if(t==='chat'&&typeof initChat==='function')initChat();
  const hint=document.getElementById('swipe-hint');
  if(hint)hint.style.display=(t==='lancamentos')?'flex':'none';
};

// Swipe iOS
function setupSwipe(wrapper){
  const gi=wrapper.querySelector('.gi'),actions=wrapper.querySelector('.gi-actions');
  if(!gi||!actions)return;
  let startX=0,curX=0,swiped=false;const MAX=120;
  function onStart(e){startX=(e.touches?e.touches[0]:e).clientX;curX=swiped?-MAX:0;gi.style.transition='none';}
  function onMove(e){const dx=(e.touches?e.touches[0]:e).clientX-startX;const nx=Math.max(-MAX,Math.min(0,curX+dx));gi.style.transform=`translateX(${nx}px)`;actions.style.opacity=Math.abs(nx)/MAX;if(Math.abs(dx)>5&&e.cancelable)e.preventDefault();}
  function onEnd(e){const dx=(e.changedTouches?e.changedTouches[0]:e).clientX-startX;gi.style.transition='transform 0.25s cubic-bezier(0.4,0,0.2,1)';if(dx<-40||(swiped&&dx<10)){gi.style.transform=`translateX(-${MAX}px)`;actions.style.opacity='1';swiped=true;}else{gi.style.transform='translateX(0)';actions.style.opacity='0';swiped=false;}}
  gi.addEventListener('touchstart',onStart,{passive:true});
  gi.addEventListener('touchmove',onMove,{passive:false});
  gi.addEventListener('touchend',onEnd);
  gi.addEventListener('mousedown',e=>{onStart(e);const mm=ev=>onMove(ev),mu=ev=>{onEnd(ev);document.removeEventListener('mousemove',mm);document.removeEventListener('mouseup',mu);};document.addEventListener('mousemove',mm);document.addEventListener('mouseup',mu);});
  document.addEventListener('click',e=>{if(swiped&&!wrapper.contains(e.target)){gi.style.transition='transform 0.25s';gi.style.transform='translateX(0)';actions.style.opacity='0';swiped=false;}},{passive:true});
}

// Edit modal
window.openEditModal=function(id){
  const item=userItems.find(i=>i.id===id);if(!item){toast('Item n√£o encontrado','error');return;}
  document.getElementById('edit-id').value=id;
  document.getElementById('edit-desc').value=item.desc||'';
  document.getElementById('edit-valor').value=item.valor||'';
  document.getElementById('edit-tipo').value=item.tipo||'gasto';
  document.getElementById('edit-recorr').value=item.recorrencia||'variavel';
  document.getElementById('edit-cat').value=item.cat||'outros';
  document.getElementById('edit-dia').value=item.dia||'';
  document.getElementById('edit-mes').value=item.mesAno||'';
  document.getElementById('modalOverlay').classList.add('open');
  document.getElementById('editModal').classList.add('open');
  document.body.style.overflow='hidden';
};
window.closeEditModal=function(){
  document.getElementById('modalOverlay').classList.remove('open');
  document.getElementById('editModal').classList.remove('open');
  document.body.style.overflow='';
};
window.saveEditItem=async function(){
  const id=document.getElementById('edit-id').value;if(!id)return;
  const updates={desc:document.getElementById('edit-desc').value.trim(),valor:parseFloat(document.getElementById('edit-valor').value),tipo:document.getElementById('edit-tipo').value,recorrencia:document.getElementById('edit-recorr').value,cat:document.getElementById('edit-cat').value,dia:parseInt(document.getElementById('edit-dia').value)||null,mesAno:document.getElementById('edit-mes').value.trim()||curKey()};
  if(!updates.desc||!updates.valor||updates.valor<=0){toast('Preencha descri√ß√£o e valor!','error');return;}
  try{showLoading('Salvando...');await db.collection('users').doc(auth.currentUser.uid).collection('items').doc(id).update(updates);const idx=userItems.findIndex(i=>i.id===id);if(idx>=0)userItems[idx]={...userItems[idx],...updates};hideLoading();toast('Atualizado! ‚úÖ');window.closeEditModal();renderAll();}catch(e){hideLoading();toast('Erro','error');}
};

// Patch renderLista para swipe
const _baseRenderLista=window.renderLista;
window.renderLista=function(){
  if(typeof _baseRenderLista==='function')_baseRenderLista();
  const lista=document.getElementById('gastos-lista');if(!lista)return;
  lista.querySelectorAll('.gi:not(.gi-wrapper .gi)').forEach(gi=>{
    const btn=gi.querySelector('[onclick*="removeItem"]');if(!btn)return;
    const id=(btn.getAttribute('onclick')||'').match(/'([^']+)'/)?.[1];if(!id)return;
    const w=document.createElement('div');w.className='gi-wrapper';
    const cleaned=gi.outerHTML.replace(/<button class="gi-del"[^>]*>[\s\S]*?<\/button>/g,'');
    w.innerHTML=`<div class="gi-actions"><button class="gi-action-btn gi-action-edit" onclick="openEditModal('${id}')"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span>Editar</span></button><button class="gi-action-btn gi-action-delete" onclick="removeItem('${id}')"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg><span>Excluir</span></button></div>${cleaned}`;
    gi.parentNode.replaceChild(w,gi);setupSwipe(w);
  });
  const hint=document.getElementById('swipe-hint');
  if(hint)hint.style.display=lista.querySelectorAll('.gi-wrapper').length>0?'flex':'none';
};

// Ripple
document.addEventListener('click',e=>{
  const btn=e.target.closest('.btn-save,.btn-auth,.btn-ob-next,.btn-google');
  if(!btn)return;
  btn.classList.remove('rippling');void btn.offsetWidth;
  btn.classList.add('ripple-wrap','rippling');
  setTimeout(()=>btn.classList.remove('rippling'),600);
},{passive:true});

</script>

</body>
</html>
